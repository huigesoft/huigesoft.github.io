import{u as $}from"./utils-B5efKl0g.js";import{g as A,s as H,c as K}from"./tpl-mZKy-qaw.js";import{l as Q}from"./object-type-otSOTyCC.js";import{l as W}from"./industry-DZUDTk8n.js";import{I as k,q as _,N as h,J as E,D as X,r as d,n as Y,p as Z,g,o as m,w as l,x as e,c as U,F as N,G as D,z as ee,b as P,E as b}from"./index-CLxOXX9K.js";const de={__name:"TplForm",emits:["onSave"],setup(le,{emit:R}){const j=R,{hasText:V}=$(),c=k("tplId",null),q=k("tpl",null),o=_({tplEnable:1}),C=_(null),v=_(!1),y=h([]),x=h([]),B={indCode:[{required:!0,message:"请选择所属行业",trigger:"blur"}],typeCode:[{required:!0,message:"请选择类型",trigger:"blur"}],tplCode:[{validator:async(a,t)=>{if(!V(t))return Promise.reject("请输入编码");const p={tplCode:t,idValue:o.value.tplId,id:"tplId"};await K(p).then(r=>r.value?Promise.reject("编码已存在！"):Promise.resolve())},trigger:"blur"}],tplName:[{required:!0,message:"请输入名称",trigger:"blur"}]},I=()=>{A({id:c.value}).then(a=>{a.success?o.value=a.value:(o.value={},b({message:a?.exception||a?.msg||"操作失败！",type:"error"}))})},T=()=>{C.value.validate().then(()=>{v.value=!0,H(o.value).then(a=>{v.value=!1,a?.success?(o.value=a.value,b({message:"保存成功！",type:"success"}),c.value=a.value.tplId,q.value=a.value,j("onSave")):b({message:a?.exception||a?.msg||"操作失败！",type:"error"})})})},F=()=>{Q({}).then(a=>{a.success&&(y.value=a.value)})},z=()=>{W({}).then(a=>{a.success&&(x.value=a.value)})},L=(a,t,p)=>{const r=new Image;r.src=a,r.onload=function(){const n=document.createElement("canvas");n.width=t,n.height=t;const s=n.getContext("2d");s.clearRect(0,0,n.width,n.height),s.drawImage(r,0,0,t,n.height),p(n.toDataURL("image/png"))}};return E(c,a=>{o.value={tplEnable:1},a!==null&&I()},{immediate:!0}),E(()=>o.value.tplPic,a=>{a!==null?L(a,32,t=>{o.value.tplIcon=t}):o.value.tplIcon=null}),X(()=>{F(),z()}),(a,t)=>{const p=d("el-option"),r=d("el-select"),n=d("el-form-item"),s=d("h-col"),f=d("el-input"),M=d("el-switch"),i=d("el-row"),S=d("h-base64-img"),w=d("el-button"),G=d("el-space"),J=d("el-form"),O=Y("loading");return Z((m(),g(J,{ref_key:"formRef",ref:C,model:o.value,"label-width":"120px",rules:B,"label-suffix":"："},{default:l(()=>[e(i,null,{default:l(()=>[e(s,{sm:10},{default:l(()=>[e(i,{gutter:10},{default:l(()=>[e(s,{sm:24},{default:l(()=>[e(n,{label:"所属行业",prop:"indCode"},{default:l(()=>[e(r,{modelValue:o.value.indCode,"onUpdate:modelValue":t[0]||(t[0]=u=>o.value.indCode=u),filterable:"",clearable:""},{default:l(()=>[(m(!0),U(N,null,D(x.value,u=>(m(),g(p,{key:u.indId,label:u.indName,value:u.indCode},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(s,{sm:24},{default:l(()=>[e(n,{label:"模板编码",prop:"tplCode"},{default:l(()=>[e(f,{modelValue:o.value.tplCode,"onUpdate:modelValue":t[1]||(t[1]=u=>o.value.tplCode=u),disabled:ee(V)(o.value?.tplId),clearable:""},null,8,["modelValue","disabled"])]),_:1})]),_:1}),e(s,{sm:24},{default:l(()=>[e(n,{label:"模板名称",prop:"tplName"},{default:l(()=>[e(f,{modelValue:o.value.tplName,"onUpdate:modelValue":t[2]||(t[2]=u=>o.value.tplName=u),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{sm:24},{default:l(()=>[e(n,{label:"模板类型",prop:"typeCode"},{default:l(()=>[e(r,{modelValue:o.value.typeCode,"onUpdate:modelValue":t[3]||(t[3]=u=>o.value.typeCode=u)},{default:l(()=>[(m(!0),U(N,null,D(y.value,u=>(m(),g(p,{key:u.typeId,label:u.typeName,value:u.typeCode},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(s,{sm:24},{default:l(()=>[e(n,{label:"模板描述",prop:"tplDesc"},{default:l(()=>[e(f,{modelValue:o.value.tplDesc,"onUpdate:modelValue":t[4]||(t[4]=u=>o.value.tplDesc=u),rows:2,type:"textarea",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{sm:24},{default:l(()=>[e(n,{label:"状态",prop:"tplEnable"},{default:l(()=>[e(M,{modelValue:o.value.tplEnable,"onUpdate:modelValue":t[5]||(t[5]=u=>o.value.tplEnable=u),"inline-prompt":"","active-value":1,"inactive-value":0,"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(s,{sm:14},{default:l(()=>[e(i,null,{default:l(()=>[e(s,{sm:12},{default:l(()=>[e(n,{label:"图片",prop:"tplPic"},{default:l(()=>[e(S,{modelValue:o.value.tplPic,"onUpdate:modelValue":t[6]||(t[6]=u=>o.value.tplPic=u)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(i,null,{default:l(()=>[e(s,{sm:12},{default:l(()=>[e(n,null,{default:l(()=>[e(G,null,{default:l(()=>[e(w,{onClick:I},{default:l(()=>[...t[7]||(t[7]=[P("重置",-1)])]),_:1}),e(w,{type:"primary",onClick:T},{default:l(()=>[...t[8]||(t[8]=[P("保存",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])),[[O,v.value]])}}};export{de as default};
