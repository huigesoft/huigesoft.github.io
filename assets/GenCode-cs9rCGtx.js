import{i as k,e as C,f as Y,_ as J,I as L,q as y,J as A,r,n as O,p as Q,g as h,o as f,w as t,x as e,b as s,h as g,c as q,F as P,G as W,E as _,s as X,D as Z,z as M,K as ee}from"./index-CLxOXX9K.js";import{u as le}from"./utils-B5efKl0g.js";const x=Y.service.system,te=c=>k({method:"post",url:x+"/sys/gen-code/saveOrUpdate",data:c}).catch(C),ae=c=>k({method:"post",url:x+"/sys/gen-code/page",data:c}).catch(C),ne=c=>k({method:"post",url:x+"/sys/gen-code/checkExists",data:c}).catch(C),oe=c=>k({method:"get",url:x+"/sys/gen-code/getById",params:c}).catch(C),se=c=>k({method:"post",url:x+"/sys/gen-code/deleteById",params:c}).catch(C),ue=c=>k({method:"post",url:x+"/sys/gen-code/deleteByIds",data:c}).catch(C),re=c=>k({method:"post",url:x+"/sys/gen-code/next",params:c}).catch(C),de={__name:"GenCodeForm",emits:["onSave"],setup(c,{expose:U,emit:B}){const b=B,{hasText:V}=le(),I={genCode:[{validator:async(n,l)=>{if(!V(l))return Promise.reject("请输入编码");const i={genCode:l,idValue:o.value.genId,id:"genId"};await ne(i).then(m=>m.value?Promise.reject("编码已存在！"):Promise.resolve())},trigger:"blur"}],genName:[{required:!0,message:"请输入名称",trigger:"blur"}]},d=L("id",null),v=y(!1),D=y(null),o=y({splitHour:0,genPeriod:0,genSeq:0,genStep:1,initSeq:1}),H=()=>{oe({id:d.value}).then(n=>{n.success?o.value=n.value:(o.value={},_({message:n?.exception||n?.msg||"操作失败！",type:"error"}))})},E=()=>{D.value.validate().then(()=>{v.value=!0,te(o.value).then(n=>{v.value=!1,n?.success?(o.value=n.value,_({message:"保存成功！",type:"success"}),b("onSave")):_({message:n?.exception||n?.msg||"操作失败！",type:"error"})})})},T=()=>{d.value=null,o.value={splitHour:0,genPeriod:0,genSeq:0,genStep:1,initSeq:1}};return A(d,n=>{n!==null&&H()},{immediate:!0}),U({save:E,reset:T}),(n,l)=>{const i=r("el-input"),m=r("el-form-item"),u=r("h-col"),S=r("QuestionFilled"),z=r("el-icon"),R=r("el-tooltip"),p=r("el-input-number"),w=r("el-option"),N=r("el-select"),$=r("el-row"),G=r("el-form"),K=O("loading");return Q((f(),h(G,{ref_key:"formRef",ref:D,model:o.value,"label-width":"120px",rules:I,"label-suffix":"："},{default:t(()=>[e($,{gutter:10},{default:t(()=>[e(u,{sm:22},{default:t(()=>[e(m,{label:"编码",prop:"genCode"},{default:t(()=>[e(i,{modelValue:o.value.genCode,"onUpdate:modelValue":l[0]||(l[0]=a=>o.value.genCode=a),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(u,{sm:22},{default:t(()=>[e(m,{label:"名称",prop:"genName"},{default:t(()=>[e(i,{modelValue:o.value.genName,"onUpdate:modelValue":l[1]||(l[1]=a=>o.value.genName=a),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(u,{sm:22},{default:t(()=>[e(m,{label:"编码格式",prop:"genFormat"},{default:t(()=>[e(i,{modelValue:o.value.genFormat,"onUpdate:modelValue":l[2]||(l[2]=a=>o.value.genFormat=a),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(u,{sm:2},{default:t(()=>[e(R,null,{content:t(()=>[...l[10]||(l[10]=[s(" 说明：",-1),g("br",null,null,-1),s(" %d：增长序列标识 ",-1),g("br",null,null,-1),s(" %04d：增长序列占4位，不够补0，例：0003 ",-1),g("br",null,null,-1),s(" %tY：年，例：2022；%tM：月，例：10；%td：日，例14 ",-1),g("br",null,null,-1),s(" 示例1：TD%tY%tm%td%04d -- TD202301310003 ",-1),g("br",null,null,-1),s(" 示例2：YK%tY%tm%td%04d -- YK202312250116 ",-1),g("br",null,null,-1),s(" 更多参考：String.format() ",-1)])]),default:t(()=>[e(z,{class:"hk_icon"},{default:t(()=>[e(S)]),_:1})]),_:1})]),_:1}),e(u,{sm:22},{default:t(()=>[e(m,{label:"编码参数",prop:"genParams"},{default:t(()=>[e(i,{modelValue:o.value.genParams,"onUpdate:modelValue":l[3]||(l[3]=a=>o.value.genParams=a),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(u,{sm:2},{default:t(()=>[e(R,null,{content:t(()=>[...l[11]||(l[11]=[s(" 说明：",-1),g("br",null,null,-1),s(" 规则格式中的参数填充 ",-1),g("br",null,null,-1),s(" 多个参数直接用半角逗号(,)分隔 ",-1),g("br",null,null,-1),s(" date：规则中的日期时间参数 ",-1),g("br",null,null,-1),s(" seq：规则中的增长序列参数 ",-1),g("br",null,null,-1),s(" 示例1：TD%tY%tm%td%04d -- date,date,date,seq -- TD202301310003 ",-1),g("br",null,null,-1),s(" 示例2：YK%tY%tm%td%04d -- date,date,date,seq -- YK202312250116 ",-1),g("br",null,null,-1)])]),default:t(()=>[e(z,{class:"hk_icon"},{default:t(()=>[e(S)]),_:1})]),_:1})]),_:1}),e(u,{sm:22},{default:t(()=>[e(m,{label:"初始化序列值",prop:"initSeq"},{default:t(()=>[e(p,{modelValue:o.value.initSeq,"onUpdate:modelValue":l[4]||(l[4]=a=>o.value.initSeq=a),style:{width:"100%"},clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(u,{sm:2},{default:t(()=>[e(R,null,{content:t(()=>[...l[12]||(l[12]=[s(" 初始化序列值，按周期重置为该值 ",-1)])]),default:t(()=>[e(z,{class:"hk_icon"},{default:t(()=>[e(S)]),_:1})]),_:1})]),_:1}),e(u,{sm:22},{default:t(()=>[e(m,{label:"步长",prop:"genStep"},{default:t(()=>[e(p,{modelValue:o.value.genStep,"onUpdate:modelValue":l[5]||(l[5]=a=>o.value.genStep=a),style:{width:"100%"},clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(u,{sm:22},{default:t(()=>[e(m,{label:"当前序列",prop:"genStep"},{default:t(()=>[e(p,{modelValue:o.value.genSeq,"onUpdate:modelValue":l[6]||(l[6]=a=>o.value.genSeq=a),style:{width:"100%"},clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(u,{sm:22},{default:t(()=>[e(m,{label:"序列周期",prop:"genPeriod"},{default:t(()=>[e(N,{modelValue:o.value.genPeriod,"onUpdate:modelValue":l[7]||(l[7]=a=>o.value.genPeriod=a),filterable:"",style:{width:"100%"}},{default:t(()=>[(f(),h(w,{key:0,value:0,label:"无"})),(f(),h(w,{key:1,value:1,label:"年"})),(f(),h(w,{key:2,value:2,label:"月"})),(f(),h(w,{key:3,value:3,label:"日"}))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(u,{sm:22},{default:t(()=>[e(m,{label:"日分割小时",prop:"splitHour"},{default:t(()=>[e(N,{modelValue:o.value.splitHour,"onUpdate:modelValue":l[8]||(l[8]=a=>o.value.splitHour=a),filterable:"",style:{width:"100%"}},{default:t(()=>[(f(),q(P,null,W(24,a=>e(w,{key:a-1,label:a-1+" 时",value:a-1},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(u,{sm:22},{default:t(()=>[e(m,{label:"备注",prop:"dictRemark"},{default:t(()=>[e(i,{modelValue:o.value.dictRemark,"onUpdate:modelValue":l[9]||(l[9]=a=>o.value.dictRemark=a),rows:2,type:"textarea",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])),[[K,v.value]])}}},ie=J(de,[["__scopeId","data-v-c6a5ac20"]]),ce={__name:"GenCode",setup(c){const U=y(null),B=y(null),b=y(!1),V=y(!1),F=y([]),I=y(null);ee("id",I);const d=X({loading:!1,open:!1,params:{total:0,page:1,size:Y.pageInfo.pageSize,expressions:[{field:"genCode",query:"like",value:""},{field:"genName",query:"like",value:""}],sorts:[]}}),v=()=>{b.value=!0,ae(d.params).then(n=>{b.value=!1,n.success?(F.value=n.value.records,d.params.total=n.value.total,d.params.page=n.value.current):(F.value=[],_({message:n?.exception||n?.msg||"操作失败！",type:"error"}))})},D=()=>{I.value=null,V.value=!0},o=n=>{I.value=n.genId,V.value=!0},H=n=>{re({genCode:n.genCode}).then(l=>{l.success?n.genCurrent=l.value:_({message:l?.exception||l?.msg||"操作失败！",type:"error"})})},E=n=>{b.value=!0,se({id:n.genId}).then(l=>{b.value=!1,l.success?(_({message:"删除成功",type:"success"}),v()):_({message:l?.exception||l?.msg||"操作失败！",type:"error"})})},T=()=>{const n=B.value.getSelectionRows();if(n.length===0)_({type:"error",message:"请选择要删除的内容？"});else{const l=n.map(i=>i.genId);b.value=!0,ue(l).then(i=>{b.value=!1,i.success?(_({message:"删除成功",type:"success"}),v()):_({message:i?.exception||i?.msg||"操作失败！",type:"error"})})}};return Z(()=>{v()}),(n,l)=>{const i=r("el-input"),m=r("el-form-item"),u=r("el-button"),S=r("el-popconfirm"),z=r("el-space"),R=r("el-form"),p=r("el-table-column"),w=r("el-table"),N=r("el-pagination"),$=r("h-list-layout"),G=r("h-modal"),K=O("loading");return f(),q(P,null,[e($,null,{header:t(()=>[e(R,{inline:!0},{default:t(()=>[e(m,{label:"编码器编码"},{default:t(()=>[e(i,{modelValue:d.params.expressions[0].value,"onUpdate:modelValue":l[0]||(l[0]=a=>d.params.expressions[0].value=a),style:{width:"150px"},clearable:""},null,8,["modelValue"])]),_:1}),e(m,{label:"编码器名称"},{default:t(()=>[e(i,{modelValue:d.params.expressions[1].value,"onUpdate:modelValue":l[1]||(l[1]=a=>d.params.expressions[1].value=a),style:{width:"150px"},clearable:""},null,8,["modelValue"])]),_:1}),e(m,null,{default:t(()=>[e(u,{type:"primary",icon:"Search",round:"",onClick:v},{default:t(()=>[...l[9]||(l[9]=[s("查询",-1)])]),_:1})]),_:1}),e(z,null,{default:t(()=>[e(u,{type:"success",icon:"CirclePlus",onClick:D},{default:t(()=>[...l[10]||(l[10]=[s("新增",-1)])]),_:1}),e(S,{title:"确定要删除吗？",onConfirm:l[2]||(l[2]=a=>T())},{reference:t(()=>[e(u,{type:"danger",icon:"Remove"},{default:t(()=>[...l[11]||(l[11]=[s("删除",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),main:t(()=>[Q((f(),h(w,{ref_key:"tableRef",ref:B,style:{width:"100%"},height:"100%",data:F.value,"highlight-current-row":"",stripe:"","show-overflow-tooltip":""},{default:t(()=>[e(p,{fixed:"left",type:"selection",width:"40"}),e(p,{prop:"genCode",label:"编码","min-width":"120"}),e(p,{prop:"genName",label:"名称","min-width":"120"}),e(p,{prop:"initSeq",label:"初始序列","min-width":"120"}),e(p,{prop:"genStep",label:"步长","min-width":"120"}),e(p,{prop:"genSeq",label:"当前序列","min-width":"120"}),e(p,{prop:"genFormat",label:"格式","min-width":"200"}),e(p,{prop:"genParams",label:"参数","min-width":"150"}),e(p,{prop:"genPeriod",label:"序列周期","min-width":"120"},{default:t(a=>[a.genPeriod===1?(f(),q(P,{key:0},[s("日")],64)):a.genPeriod===2?(f(),q(P,{key:1},[s("月")],64)):a.genPeriod===3?(f(),q(P,{key:2},[s("年")],64)):(f(),q(P,{key:3},[s("无")],64))]),_:1}),e(p,{prop:"splitHour",label:"日分割小时","min-width":"120"}),e(p,{prop:"genCurrent",label:"当前编号",fixed:"right","min-width":"200"}),e(p,{prop:"action",label:"操作","min-width":150,fixed:"right",align:"center"},{default:t(a=>[e(u,{type:"success",size:"small",title:"获取编号",icon:"CaretRight",onClick:j=>H(a.row),circle:""},null,8,["onClick"]),e(u,{type:"primary",size:"small",title:"编辑",icon:"Edit",onClick:j=>o(a.row),circle:""},null,8,["onClick"]),e(S,{title:"确定要删除吗？",onConfirm:j=>E(a.row)},{reference:t(()=>[e(u,{type:"danger",size:"small",title:"删除",icon:"Remove",circle:""})]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[K,b.value]])]),footer:t(()=>[e(N,{"current-page":d.params.page,"onUpdate:currentPage":l[3]||(l[3]=a=>d.params.page=a),"page-size":d.params.size,"onUpdate:pageSize":l[4]||(l[4]=a=>d.params.size=a),total:d.params.total,layout:M(Y).pageInfo.layout,"page-sizes":M(Y).pageInfo.pageSizes,"pager-count":5,onChange:v,background:"",size:"small"},null,8,["current-page","page-size","total","layout","page-sizes"])]),_:1}),e(G,{modelValue:V.value,"onUpdate:modelValue":l[7]||(l[7]=a=>V.value=a),title:"编码器信息",width:"600",onClose:l[8]||(l[8]=a=>U.value?.reset())},{footer:t(()=>[e(u,{onClick:l[5]||(l[5]=()=>V.value=!1)},{default:t(()=>[...l[12]||(l[12]=[s("关闭",-1)])]),_:1}),e(u,{type:"primary",onClick:l[6]||(l[6]=()=>U.value.save())},{default:t(()=>[...l[13]||(l[13]=[s("保存",-1)])]),_:1})]),default:t(()=>[e(ie,{ref_key:"formRef",ref:U,onOnSave:v},null,512)]),_:1},8,["modelValue"])],64)}}};export{ce as default};
