import{i as w,e as x,f as D,I as L,q as y,J as Q,r as s,n as A,p as O,g as $,o as R,w as l,x as o,z as F,E as _,O as T,s as W,D as X,c as Y,b as h,t as j,a as Z,F as ee,K as q}from"./index-CLxOXX9K.js";import{u as oe}from"./utils-B5efKl0g.js";const V=D.service.hdb,te=p=>w({method:"post",url:V+"/hdb/protocol/saveOrUpdate",data:p}).catch(x),le=p=>w({method:"post",url:V+"/hdb/protocol/page",data:p}).catch(x),ae=p=>w({method:"post",url:V+"/hdb/protocol/checkExists",data:p}).catch(x),re=p=>w({method:"get",url:V+"/hdb/protocol/getById",params:p}).catch(x),se=p=>w({method:"post",url:V+"/hdb/protocol/deleteById",params:p}).catch(x),ne=p=>w({method:"post",url:V+"/hdb/protocol/deleteByIds",data:p}).catch(x),ue={__name:"ProtocolForm",emits:["onSave"],setup(p,{expose:k,emit:I}){const f=I,{hasText:v}=oe(),C={protocolCode:[{validator:async(t,e)=>{if(!v(e))return Promise.reject("请输入编码");const u={protocolCode:e,idValue:a.value.protocolId,id:"protocolId"};await ae(u).then(m=>m.value?Promise.reject("编码已存在！"):Promise.resolve())},trigger:"blur"}],protocolName:[{required:!0,message:"请输入名称",trigger:"blur"}]},b=L("id",null),n=y(!1),c=y(null),a=y({}),U=()=>{re({id:b.value}).then(t=>{t.success?a.value=t.value:(a.value={},_({message:t?.exception||t?.msg||"操作失败！",type:"error"}))})},N=()=>{c.value.validate().then(()=>{n.value=!0,te(a.value).then(t=>{n.value=!1,t?.success?(a.value=t.value,_({message:"保存成功！",type:"success"}),f("onSave")):_({message:t?.exception||t?.msg||"操作失败！",type:"error"})})})},S=()=>{b.value=null,a.value={},c.value.clearValidate()};return Q(b,t=>{t!==null&&U()},{immediate:!0}),k({save:N,reset:S}),(t,e)=>{const u=s("el-input"),m=s("el-form-item"),d=s("h-col"),B=s("el-row"),P=s("h-code-editor"),E=s("el-form"),i=A("loading");return O((R(),$(E,{ref_key:"formRef",ref:c,model:a.value,"label-width":"120px",rules:C,"label-suffix":"：",style:{height:"100%"}},{default:l(()=>[o(B,{gutter:10},{default:l(()=>[o(d,{xs:24,md:8},{default:l(()=>[o(m,{label:"协议编码",prop:"protocolCode"},{default:l(()=>[o(u,{modelValue:a.value.protocolCode,"onUpdate:modelValue":e[0]||(e[0]=g=>a.value.protocolCode=g),readonly:F(v)(a.value?.protocolId),clearable:""},null,8,["modelValue","readonly"])]),_:1})]),_:1}),o(d,{xs:24,md:8},{default:l(()=>[o(m,{label:"协议名称",prop:"protocolName"},{default:l(()=>[o(u,{modelValue:a.value.protocolName,"onUpdate:modelValue":e[1]||(e[1]=g=>a.value.protocolName=g),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),o(d,{sm:24},{default:l(()=>[o(m,{label:"协议描述",prop:"protocolDesc"},{default:l(()=>[o(u,{modelValue:a.value.protocolDesc,"onUpdate:modelValue":e[2]||(e[2]=g=>a.value.protocolDesc=g),rows:2,type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),o(m,{label:"协议体",prop:"protocolBody",style:{height:"calc(100% - 120px)"}},{default:l(()=>[o(P,{modelValue:a.value.protocolBody,"onUpdate:modelValue":e[3]||(e[3]=g=>a.value.protocolBody=g),style:{height:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[i,n.value]])}}},ie={__name:"Protocol",setup(p){const k=T("formRef"),I=T("tableRef"),f=y(!1),v=y(!1),z=y([]),C=y(null);q("id",C);const b=y(null);q("code",b);const n=W({loading:!1,open:!1,params:{total:0,page:1,size:D.pageInfo.pageSize,expressions:[{field:"protocolCode",query:"like",value:""},{field:"protocolName",query:"like",value:""}],sorts:[]}}),c=()=>{f.value=!0,le(n.params).then(t=>{f.value=!1,t.success?(z.value=t.value.records,n.params.total=t.value.total,n.params.page=t.value.current):(z.value=[],_({message:t?.exception||t?.msg||"操作失败！",type:"error"}))})},a=()=>{C.value=null,b.value=null,v.value=!0},U=t=>{C.value=t.protocolId,b.value=t.protocolCode,v.value=!0},N=t=>{f.value=!0,se({id:t.protocolId}).then(e=>{f.value=!1,e.success?(_({message:"删除成功",type:"success"}),c()):_({message:e?.exception||e?.msg||"操作失败！",type:"error"})})},S=()=>{const t=I.value.getSelectionRows();if(t.length===0)_({type:"error",message:"请选择要删除的内容？"});else{const e=t.map(u=>u.protocolId);f.value=!0,ne(e).then(u=>{f.value=!1,u.success?(_({message:"删除成功",type:"success"}),c()):_({message:u?.exception||u?.msg||"操作失败！",type:"error"})})}};return X(()=>{c()}),(t,e)=>{const u=s("el-input"),m=s("el-form-item"),d=s("el-button"),B=s("el-popconfirm"),P=s("el-space"),E=s("el-form"),i=s("el-table-column"),g=s("el-table"),M=s("el-pagination"),H=s("h-list-layout"),J=s("h-modal"),K=A("loading");return R(),Y(ee,null,[o(H,null,{header:l(()=>[o(E,{inline:!0},{default:l(()=>[o(m,{label:"协议编码"},{default:l(()=>[o(u,{modelValue:n.params.expressions[0].value,"onUpdate:modelValue":e[0]||(e[0]=r=>n.params.expressions[0].value=r),style:{width:"150px"},clearable:""},null,8,["modelValue"])]),_:1}),o(m,{label:"协议名称"},{default:l(()=>[o(u,{modelValue:n.params.expressions[1].value,"onUpdate:modelValue":e[1]||(e[1]=r=>n.params.expressions[1].value=r),style:{width:"150px"},clearable:""},null,8,["modelValue"])]),_:1}),o(m,null,{default:l(()=>[o(d,{type:"primary",icon:"Search",round:"",onClick:c},{default:l(()=>[...e[8]||(e[8]=[h("查询",-1)])]),_:1})]),_:1}),o(P,null,{default:l(()=>[o(d,{type:"success",icon:"CirclePlus",onClick:a},{default:l(()=>[...e[9]||(e[9]=[h("新增",-1)])]),_:1}),o(B,{title:"确定要删除吗？",onConfirm:e[2]||(e[2]=r=>S())},{reference:l(()=>[o(d,{type:"danger",icon:"Remove"},{default:l(()=>[...e[10]||(e[10]=[h("删除",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),main:l(()=>[O((R(),$(g,{ref_key:"tableRef",ref:I,style:{width:"100%"},height:"100%",data:z.value,"highlight-current-row":"",stripe:"","show-overflow-tooltip":""},{default:l(()=>[o(i,{fixed:"left",type:"selection",width:"40"}),o(i,{prop:"protocolCode",label:"编码","min-width":"120"}),o(i,{prop:"protocolName",label:"名称","min-width":"120"}),o(i,{prop:"protocolDesc",label:"描述","min-width":"120"}),o(i,{prop:"createBy",label:"创建人","min-width":"100"}),o(i,{prop:"createAt",label:"创建时间","min-width":"180"},{default:l(r=>[h(j(t.$defaultDateTimeFormat(r.row.createAt)),1)]),_:1}),o(i,{prop:"updateBy",label:"最后修改人","min-width":"100"}),o(i,{prop:"updateAt",label:"最后修改时间","min-width":"180"},{default:l(r=>[h(j(t.$defaultDateTimeFormat(r.row.updateAt)),1)]),_:1}),o(i,{prop:"action",label:"操作","min-width":120,fixed:"right",align:"center"},{default:l(r=>[o(d,{type:"primary",size:"small",title:"编辑",icon:"Edit",onClick:G=>U(r.row),circle:""},null,8,["onClick"]),o(B,{title:"确定要删除吗？",onConfirm:G=>N(r.row)},{reference:l(()=>[o(d,{type:"danger",size:"small",title:"删除",icon:"Remove",circle:""})]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[K,f.value]])]),footer:l(()=>[o(M,{"current-page":n.params.page,"onUpdate:currentPage":e[3]||(e[3]=r=>n.params.page=r),"page-size":n.params.size,"onUpdate:pageSize":e[4]||(e[4]=r=>n.params.size=r),total:n.params.total,layout:F(D).pageInfo.layout,"page-sizes":F(D).pageInfo.pageSizes,"pager-count":5,onChange:c,background:"",size:"small"},null,8,["current-page","page-size","total","layout","page-sizes"])]),_:1}),o(J,{modelValue:v.value,"onUpdate:modelValue":e[7]||(e[7]=r=>v.value=r),title:"协议开发",width:"100%"},{footer:l(()=>[o(d,{onClick:e[5]||(e[5]=()=>v.value=!1)},{default:l(()=>[...e[11]||(e[11]=[h("关闭",-1)])]),_:1}),o(d,{type:"primary",onClick:e[6]||(e[6]=()=>k.value?.save())},{default:l(()=>[...e[12]||(e[12]=[h("保存",-1)])]),_:1})]),default:l(()=>[v.value?(R(),$(ue,{key:0,ref_key:"formRef",ref:k,onOnSave:c},null,512)):Z("",!0)]),_:1},8,["modelValue"])],64)}}};export{ie as default};
