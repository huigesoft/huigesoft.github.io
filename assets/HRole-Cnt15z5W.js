import{I as P,q as p,J as j,r as s,n as q,p as T,g as D,o as N,w as o,x as l,z as M,E as y,D as F,h as L,t as Q,s as W,f as K,c as X,b as R,F as Y,K as Z}from"./index-CLxOXX9K.js";import{s as ee,g as le,c as te,a as oe,b as ae,p as se,d as ne,e as ue}from"./role-CJhSrFwP.js";import{u as re}from"./utils-B5efKl0g.js";import{r as ie}from"./menu-Dfd8G2qV.js";const de={__name:"RoleForm",emits:["onSave"],setup($,{expose:C,emit:g}){const h=g,{hasText:c}=re(),b={roleCode:[{validator:async(i,f)=>{if(!c(f))return Promise.reject("请输入编码");const a={roleCode:f,idValue:t.value.roleId,id:"roleId"};await te(a).then(e=>e.value?Promise.reject("编码已存在！"):Promise.resolve())},trigger:"blur"}],roleName:[{required:!0,message:"请输入角色名称",trigger:"blur"}]},w=P("id",null),k=p(!1),u=p(null),t=p({status:1}),d=()=>{le({id:w.value}).then(i=>{i.success?t.value=i.value:(t.value={},y({message:i?.exception||i?.msg||"操作失败！",type:"error"}))})},v=()=>{u.value.validate().then(()=>{k.value=!0,ee(t.value).then(i=>{k.value=!1,i?.success?(t.value=i.value,y({message:"保存成功！",type:"success"}),h("onSave")):y({message:i?.exception||i?.msg||"操作失败！",type:"error"})})})},r=()=>{w.value=null,t.value={status:1}};return j(w,i=>{i!==null&&d()},{immediate:!0}),C({save:v,reset:r}),(i,f)=>{const a=s("el-input"),e=s("el-form-item"),m=s("h-col"),V=s("el-switch"),_=s("el-row"),S=s("el-form"),B=q("loading");return T((N(),D(S,{ref_key:"formRef",ref:u,model:t.value,"label-width":"120px",rules:b,"label-suffix":"："},{default:o(()=>[l(_,{gutter:10},{default:o(()=>[l(m,{sm:24},{default:o(()=>[l(e,{label:"角色编码",prop:"roleCode"},{default:o(()=>[l(a,{modelValue:t.value.roleCode,"onUpdate:modelValue":f[0]||(f[0]=I=>t.value.roleCode=I),readonly:M(c)(t.value?.roleId),clearable:""},null,8,["modelValue","readonly"])]),_:1})]),_:1}),l(m,{sm:24},{default:o(()=>[l(e,{label:"角色名称",prop:"roleName"},{default:o(()=>[l(a,{modelValue:t.value.roleName,"onUpdate:modelValue":f[1]||(f[1]=I=>t.value.roleName=I),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(m,{sm:24},{default:o(()=>[l(e,{label:"状态",prop:"roleStatus"},{default:o(()=>[l(V,{modelValue:t.value.roleStatus,"onUpdate:modelValue":f[2]||(f[2]=I=>t.value.roleStatus=I),"inline-prompt":"","active-value":1,"inactive-value":0,"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])),[[B,k.value]])}}},me={__name:"RoleMenu",setup($,{expose:C}){const g=p(null),h=P("id",null),c=p([]),x=()=>{h.value=null},b=p([]),w={value:"value",label:"title",children:"children"},k=()=>{ie({}).then(t=>{t.success&&(b.value=t.value)}),ae({roleId:h.value}).then(t=>{t.success&&t.value.length>0&&(c.value=t.value.filter(d=>{const v=g.value.getNode(d.menuId)?.childNodes;return v&&v.length>0?!1:d!==null&&d.half==1}).map(d=>d.menuId))})},u=()=>{const t=g.value.getCheckedKeys(),d=g.value.getHalfCheckedKeys();console.log(t),console.log(d);const v=[];for(let r=0;r<t.length;r++)v.push({roleId:h.value,menuId:t[r],half:1});for(let r=0;r<d.length;r++)v.push({roleId:h.value,menuId:d[r],half:0});oe(v).then(r=>{r.success?y({message:"保存成功",type:"success"}):y({message:r?.exception||r?.msg||"操作失败！",type:"error"})})};return j(h,t=>{t!==null?k():g.value.setCheckedKeys([],!1)},{immediate:!0}),C({save:u,reset:x}),F(()=>{}),(t,d)=>{const v=s("h-icon"),r=s("el-space"),i=s("el-tree"),f=s("el-auto-resizer");return N(),D(f,null,{default:o(({width:a,height:e})=>[l(i,{ref_key:"treeRef",ref:g,data:b.value,"default-expand-all":"","default-checked-keys":c.value,props:w,"node-key":"key","show-checkbox":"",height:e},{default:o(({node:m,data:V})=>[l(r,{wrap:""},{default:o(()=>[l(v,{type:V.iconStr},null,8,["type"]),L("span",null,Q(m.label),1)]),_:2},1024)]),_:1},8,["data","default-checked-keys","height"])]),_:1})}}},_e={__name:"HRole",setup($){const C=p(null),g=p(null),h=p(null),c=p(!1),x=p(!1),b=p(!1),w=p([]),k=p(null);Z("id",k);const u=W({loading:!1,open:!1,params:{total:0,page:1,size:K.pageInfo.pageSize,expressions:[{field:"roleCode",query:"like",value:""},{field:"roleName",query:"like",value:""}],sorts:[]}}),t=()=>{c.value=!0,se(u.params).then(a=>{c.value=!1,a.success?(w.value=a.value.records,u.params.total=a.value.total,u.params.page=a.value.current):(w.value=[],y({message:a?.exception||a?.msg||"操作失败！",type:"error"}))})},d=()=>{k.value=null,x.value=!0},v=a=>{k.value=a.roleId,x.value=!0},r=a=>{k.value=a.roleId,b.value=!0},i=a=>{c.value=!0,ne({id:a.roleId}).then(e=>{c.value=!1,e.success?(y({message:"删除成功",type:"success"}),t()):y({message:e?.exception||e?.msg||"操作失败！",type:"error"})})},f=()=>{const a=h.value.getSelectionRows();if(a.length===0)y({type:"error",message:"请选择要删除的内容？"});else{const e=a.map(m=>m.roleId);c.value=!0,ue(e).then(m=>{c.value=!1,m.success?(y({message:"删除成功",type:"success"}),t()):y({message:m?.exception||m?.msg||"操作失败！",type:"error"})})}};return F(()=>{t()}),(a,e)=>{const m=s("el-input"),V=s("el-form-item"),_=s("el-button"),S=s("el-popconfirm"),B=s("el-space"),I=s("el-form"),z=s("el-table-column"),H=s("el-switch"),O=s("el-table"),J=s("el-pagination"),A=s("h-list-layout"),E=s("h-modal"),G=q("loading");return N(),X(Y,null,[l(A,null,{header:o(()=>[l(I,{inline:!0},{default:o(()=>[l(V,{label:"角色编码"},{default:o(()=>[l(m,{modelValue:u.params.expressions[0].value,"onUpdate:modelValue":e[0]||(e[0]=n=>u.params.expressions[0].value=n),style:{width:"150px"},clearable:""},null,8,["modelValue"])]),_:1}),l(V,{label:"角色名称"},{default:o(()=>[l(m,{modelValue:u.params.expressions[1].value,"onUpdate:modelValue":e[1]||(e[1]=n=>u.params.expressions[1].value=n),style:{width:"150px"},clearable:""},null,8,["modelValue"])]),_:1}),l(V,null,{default:o(()=>[l(_,{type:"primary",icon:"Search",round:"",onClick:t},{default:o(()=>[...e[13]||(e[13]=[R("查询",-1)])]),_:1})]),_:1}),l(B,null,{default:o(()=>[l(_,{type:"success",icon:"CirclePlus",onClick:d},{default:o(()=>[...e[14]||(e[14]=[R("新增",-1)])]),_:1}),l(S,{title:"确定要删除吗？",onConfirm:e[2]||(e[2]=n=>f())},{reference:o(()=>[l(_,{type:"danger",icon:"Remove"},{default:o(()=>[...e[15]||(e[15]=[R("删除",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),main:o(()=>[T((N(),D(O,{ref_key:"tableRef",ref:h,style:{width:"100%"},height:"100%",data:w.value,"highlight-current-row":"",stripe:"","show-overflow-tooltip":""},{default:o(()=>[l(z,{fixed:"left",type:"selection",width:"40"}),l(z,{prop:"roleCode",label:"编码","min-width":"120"}),l(z,{prop:"roleName",label:"名称","min-width":"120"}),l(z,{prop:"roleStatus",label:"状态","min-width":"80"},{default:o(n=>[l(H,{modelValue:n.row.roleStatus,"onUpdate:modelValue":U=>n.row.roleStatus=U,"inline-prompt":"","active-value":1,"inactive-value":0,"active-text":"启用","inactive-text":"禁用","before-change":()=>!1,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(z,{prop:"action",label:"操作","min-width":130,fixed:"right",align:"center"},{default:o(n=>[l(_,{type:"primary",size:"small",title:"编辑",icon:"Edit",onClick:U=>v(n.row),circle:""},null,8,["onClick"]),l(_,{type:"success",size:"small",title:"菜单权限",icon:"Menu",onClick:U=>r(n.row),circle:""},null,8,["onClick"]),l(S,{title:"确定要删除吗？",onConfirm:U=>i(n.row)},{reference:o(()=>[l(_,{type:"danger",size:"small",title:"删除",icon:"Remove",circle:""})]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[G,c.value]])]),footer:o(()=>[l(J,{"current-page":u.params.page,"onUpdate:currentPage":e[3]||(e[3]=n=>u.params.page=n),"page-size":u.params.size,"onUpdate:pageSize":e[4]||(e[4]=n=>u.params.size=n),total:u.params.total,layout:M(K).pageInfo.layout,"page-sizes":M(K).pageInfo.pageSizes,"pager-count":5,onChange:t,background:"",size:"small"},null,8,["current-page","page-size","total","layout","page-sizes"])]),_:1}),l(E,{modelValue:x.value,"onUpdate:modelValue":e[7]||(e[7]=n=>x.value=n),title:"角色信息",width:"400",onClose:e[8]||(e[8]=()=>C.value?.reset())},{footer:o(()=>[l(_,{onClick:e[5]||(e[5]=()=>x.value=!1)},{default:o(()=>[...e[16]||(e[16]=[R("关闭",-1)])]),_:1}),l(_,{type:"primary",onClick:e[6]||(e[6]=()=>C.value.save())},{default:o(()=>[...e[17]||(e[17]=[R("保存",-1)])]),_:1})]),default:o(()=>[l(de,{ref_key:"formRef",ref:C,onOnSave:t},null,512)]),_:1},8,["modelValue"]),l(E,{modelValue:b.value,"onUpdate:modelValue":e[11]||(e[11]=n=>b.value=n),title:"菜单权限",width:"400",onClose:e[12]||(e[12]=()=>g.value?.reset())},{footer:o(()=>[l(_,{onClick:e[9]||(e[9]=()=>b.value=!1)},{default:o(()=>[...e[18]||(e[18]=[R("关闭",-1)])]),_:1}),l(_,{type:"primary",onClick:e[10]||(e[10]=()=>g.value.save())},{default:o(()=>[...e[19]||(e[19]=[R("保存",-1)])]),_:1})]),default:o(()=>[l(me,{ref_key:"menuRef",ref:g},null,512)]),_:1},8,["modelValue"])],64)}}};export{_e as default};
