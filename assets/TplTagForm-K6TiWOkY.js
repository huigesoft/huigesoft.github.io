import{u as F}from"./utils-B5efKl0g.js";import{s as R,g as z,c as J}from"./tpl-tag-D_2g8AFQ.js";import{I,q as T,J as L,r as n,n as M,p as G,g as v,o as f,w as t,x as e,a as U,z as S,b as p,E as x}from"./index-CLxOXX9K.js";const Z={__name:"TplTagForm",emits:["onSave"],setup(K,{expose:k,emit:N}){const P=N,{hasText:g}=F(),w=I("tpl",{}),_=I("tagId",null),a=T({}),c=T(null),V=T(!1),B={tagName:[{validator:async(d,l)=>{if(!g(l))return Promise.reject("请输入点名");const r={tagName:l,tplCode:w.value?.tplCode,idValue:a.value.tagId,id:"tagId"};await J(r).then(u=>u.value?Promise.reject("点名已存在！"):Promise.resolve())},trigger:"blur"}],tagTitle:[{required:!0,message:"请输入标题",trigger:"blur"}]},O=()=>{z({id:_.value}).then(d=>{d.success?a.value=d.value:(a.value={},x({message:d?.exception||d?.msg||"操作失败！",type:"error"}))})},D=d=>{c.value.validate().then(()=>{V.value=!0,a.value.dataType>2&&(a.value.decimalPlace=null),R(a.value).then(l=>{V.value=!1,l?.success?(a.value=l.value,x({message:"保存成功！",type:"success"}),P("onSave"),d&&d()):x({message:l?.exception||l?.msg||"操作失败！",type:"error"})})})},b=()=>{_.value=null,a.value={tplCode:w.value?.tplCode,dataType:1,tagDirection:1,saveHis:1,tagScale:1,tagOffset:0,decimalPlace:3}},j=()=>{D(()=>{b()})};return L(_,d=>{d!==null?O():b(),c?.value?.clearValidate()},{immediate:!0}),k({save:D,reset:b,saveAndAdd:j}),(d,l)=>{const r=n("el-input"),u=n("el-form-item"),s=n("h-col"),m=n("el-option"),E=n("el-select"),i=n("el-radio"),C=n("el-radio-group"),y=n("el-input-number"),H=n("el-row"),q=n("el-form"),A=M("loading");return G((f(),v(q,{ref_key:"formRef",ref:c,model:a.value,"label-width":"120px",rules:B,"label-suffix":"："},{default:t(()=>[e(H,{gutter:10},{default:t(()=>[e(s,{sm:24},{default:t(()=>[e(u,{label:"监控点名",prop:"tagName"},{default:t(()=>[e(r,{modelValue:a.value.tagName,"onUpdate:modelValue":l[0]||(l[0]=o=>a.value.tagName=o),disabled:S(g)(a.value?.tagId),clearable:""},null,8,["modelValue","disabled"])]),_:1})]),_:1}),e(s,{sm:24},{default:t(()=>[e(u,{label:"监控点标题",prop:"tagTitle"},{default:t(()=>[e(r,{modelValue:a.value.tagTitle,"onUpdate:modelValue":l[1]||(l[1]=o=>a.value.tagTitle=o),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{sm:24},{default:t(()=>[e(u,{label:"数据类型",prop:"dataType"},{default:t(()=>[e(E,{modelValue:a.value.dataType,"onUpdate:modelValue":l[2]||(l[2]=o=>a.value.dataType=o),disabled:S(g)(a.value?.tagId)},{default:t(()=>[e(m,{label:"单精度浮点型(Float)",value:1}),e(m,{label:"双精度浮点型(Double)",value:2}),e(m,{label:"8位整型(Byte)",value:3}),e(m,{label:"16位整型(Short)",value:4}),e(m,{label:"32位整型(Int)",value:5}),e(m,{label:"64位整型(Long)",value:6}),e(m,{label:"布尔型(Bool)",value:7}),e(m,{label:"字符串(String)",value:8})]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),e(s,{sm:24},{default:t(()=>[e(u,{label:"读写方向",prop:"tagDirection"},{default:t(()=>[e(C,{modelValue:a.value.tagDirection,"onUpdate:modelValue":l[3]||(l[3]=o=>a.value.tagDirection=o)},{default:t(()=>[e(i,{value:1},{default:t(()=>[...l[10]||(l[10]=[p("只读",-1)])]),_:1}),e(i,{value:2},{default:t(()=>[...l[11]||(l[11]=[p("只写",-1)])]),_:1}),e(i,{value:3},{default:t(()=>[...l[12]||(l[12]=[p("可读可写",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a.value.dataType===1||a.value.dataType===2?(f(),v(s,{key:0,sm:24},{default:t(()=>[e(u,{label:"小数位",prop:"decimalPlace"},{default:t(()=>[e(y,{modelValue:a.value.decimalPlace,"onUpdate:modelValue":l[4]||(l[4]=o=>a.value.decimalPlace=o),min:0,max:8,precision:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})):U("",!0),a.value.dataType!==7&&a.value.dataType!==8?(f(),v(s,{key:1,sm:24},{default:t(()=>[e(u,{label:"缩放",prop:"tagScale"},{default:t(()=>[e(y,{modelValue:a.value.tagScale,"onUpdate:modelValue":l[5]||(l[5]=o=>a.value.tagScale=o),style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})):U("",!0),a.value.dataType!==7&&a.value.dataType!==8?(f(),v(s,{key:2,sm:24},{default:t(()=>[e(u,{label:"偏移量",prop:"tagOffset"},{default:t(()=>[e(y,{modelValue:a.value.tagOffset,"onUpdate:modelValue":l[6]||(l[6]=o=>a.value.tagOffset=o),style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})):U("",!0),e(s,{sm:24},{default:t(()=>[e(u,{label:"保存历史",prop:"isSave"},{default:t(()=>[e(C,{modelValue:a.value.saveHis,"onUpdate:modelValue":l[7]||(l[7]=o=>a.value.saveHis=o)},{default:t(()=>[e(i,{value:1},{default:t(()=>[...l[13]||(l[13]=[p("保存",-1)])]),_:1}),e(i,{value:0},{default:t(()=>[...l[14]||(l[14]=[p("不保存",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(s,{sm:24},{default:t(()=>[e(u,{label:"单位",prop:"tagUnit"},{default:t(()=>[e(r,{modelValue:a.value.tagUnit,"onUpdate:modelValue":l[8]||(l[8]=o=>a.value.tagUnit=o),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{sm:24},{default:t(()=>[e(u,{label:"描述",prop:"tagDesc"},{default:t(()=>[e(r,{modelValue:a.value.tagDesc,"onUpdate:modelValue":l[9]||(l[9]=o=>a.value.tagDesc=o),rows:2,type:"textarea",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])),[[A,V.value]])}}};export{Z as default};
