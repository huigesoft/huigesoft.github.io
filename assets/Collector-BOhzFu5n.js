import{I as D,q as I,O as q,J as Z,r as s,n as O,p as M,g as j,o as B,w as t,x as e,a as ae,z as T,b,E as v,f as E,s as ee,c as le,t as X,F as te,K as Y,D as ne,P as se}from"./index-CLxOXX9K.js";import{s as re,r as ue,g as ie,c as de,a as me,b as pe,d as ce,p as fe,e as ve,f as ge,h as _e,i as be,j as ye}from"./collector-tag-CejSycyU.js";import{u as oe}from"./utils-B5efKl0g.js";const we={__name:"CollectorForm",emits:["onSave"],setup(J,{expose:U,emit:S}){const R=S,{hasText:g}=oe(),z={collectorCode:[{validator:async(m,n)=>{if(!g(n))return Promise.reject("请输入编码");const l={collectorCode:n,idValue:a.value.collectorId,id:"collectorId"};await de(l).then(o=>o.value?Promise.reject("编码已存在！"):Promise.resolve())},trigger:"blur"}],collectorName:[{required:!0,message:"请输入名称",trigger:"blur"}],collectorAccount:[{required:!0,message:"请输入连接账号",trigger:"blur"}],collectorPassword:[{required:!0,message:"请输入连接密码",trigger:"blur"}]},k=D("id",null),V=I(!1),_=q("formRef"),a=I({collectorEnable:1}),c=()=>{ie({id:k.value}).then(m=>{m.success?a.value=m.value:(a.value={},v({message:m?.exception||m?.msg||"操作失败！",type:"error"}))})},i=()=>{_.value.validate().then(()=>{V.value=!0,re(a.value).then(m=>{V.value=!1,m?.success?(a.value=m.value,v({message:"保存成功！",type:"success"}),R("onSave")):v({message:m?.exception||m?.msg||"操作失败！",type:"error"})})})},N=()=>{ue({size:2,len:"12"}).then(m=>{if(m.success){const n=m.value;a.value.collectorAccount=n[0],a.value.collectorPassword=n[1]}})},$=()=>{a.value.collectorAccount=null,a.value.collectorPassword=null},P=()=>{k.value=null,a.value={collectorEnable:1},_.value.clearValidate()};return Z(k,m=>{m!==null&&c()},{immediate:!0}),U({save:i,reset:P}),(m,n)=>{const l=s("el-input"),o=s("el-form-item"),d=s("h-col"),y=s("el-button"),p=s("el-switch"),x=s("el-row"),h=s("el-form"),A=O("loading");return M((B(),j(h,{ref_key:"formRef",ref:_,model:a.value,"label-width":"120px",rules:z,"label-suffix":"："},{default:t(()=>[e(x,{gutter:10},{default:t(()=>[e(d,{sm:24},{default:t(()=>[e(o,{label:"采集器编码",prop:"collectorCode"},{default:t(()=>[e(l,{modelValue:a.value.collectorCode,"onUpdate:modelValue":n[0]||(n[0]=C=>a.value.collectorCode=C),readonly:T(g)(a.value?.collectorId),clearable:""},null,8,["modelValue","readonly"])]),_:1})]),_:1}),e(d,{sm:24},{default:t(()=>[e(o,{label:"采集器名称",prop:"collectorName"},{default:t(()=>[e(l,{modelValue:a.value.collectorName,"onUpdate:modelValue":n[1]||(n[1]=C=>a.value.collectorName=C),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),T(g)(a.value?.collectorId)?ae("",!0):(B(),j(d,{key:0,sm:24},{default:t(()=>[e(o,null,{default:t(()=>[e(y,{type:"primary",onClick:N},{default:t(()=>[...n[5]||(n[5]=[b("生成账号",-1)])]),_:1}),e(y,{onClick:$},{default:t(()=>[...n[6]||(n[6]=[b("清除账号",-1)])]),_:1})]),_:1})]),_:1})),e(d,{sm:24},{default:t(()=>[e(o,{label:"连接账号",prop:"collectorAccount"},{default:t(()=>[e(l,{modelValue:a.value.collectorAccount,"onUpdate:modelValue":n[2]||(n[2]=C=>a.value.collectorAccount=C),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{sm:24},{default:t(()=>[e(o,{label:"连接密码",prop:"collectorPassword"},{default:t(()=>[e(l,{modelValue:a.value.collectorPassword,"onUpdate:modelValue":n[3]||(n[3]=C=>a.value.collectorPassword=C),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{sm:24},{default:t(()=>[e(o,{label:"状态",prop:"collectorEnable"},{default:t(()=>[e(p,{modelValue:a.value.collectorEnable,"onUpdate:modelValue":n[4]||(n[4]=C=>a.value.collectorEnable=C),"inline-prompt":"","active-value":1,"inactive-value":0,"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])),[[A,V.value]])}}},Ve={__name:"CollectorTagForm",emits:["onSave"],setup(J,{expose:U,emit:S}){const R=S,{hasText:g}=oe(),z={tagName:[{validator:async(n,l)=>{if(!g(l))return Promise.reject("请输入点名");const o={tagName:l,collectorId:k.value,idValue:i.value.tagId,id:"tagId"};await ce(o).then(d=>d.value?Promise.reject("点名已存在！"):Promise.resolve())},trigger:"blur"}],tagType:[{required:!0,message:"请选择点类型",trigger:"blur"}]},k=D("id",null),V=D("code",null),_=D("tagId",null),a=I(!1),c=I(null),i=I({tagType:1}),N=()=>{pe({id:_.value}).then(n=>{n.success?i.value=n.value:(i.value={},v({message:n?.exception||n?.msg||"操作失败！",type:"error"}))})},$=n=>{c.value.validate().then(()=>{a.value=!0,i.value.collectorId=k.value,i.value.collectorCode=V.value,me(i.value).then(l=>{a.value=!1,l?.success?(i.value=l.value,v({message:"保存成功！",type:"success"}),R("onSave"),n&&n()):v({message:l?.exception||l?.msg||"操作失败！",type:"error"})})})},P=()=>{$(()=>{m()})},m=()=>{i.value={tagType:1},_.value=null,c.value.clearValidate()};return Z(_,n=>{n!==null&&N()},{immediate:!0}),U({save:$,reset:m,saveAndAdd:P}),(n,l)=>{const o=s("el-input"),d=s("el-form-item"),y=s("h-col"),p=s("el-option"),x=s("el-select"),h=s("el-row"),A=s("el-form"),C=O("loading");return M((B(),j(A,{ref_key:"formRef",ref:c,model:i.value,"label-width":"120px",rules:z,"label-suffix":"："},{default:t(()=>[e(h,{gutter:10},{default:t(()=>[e(y,{sm:24},{default:t(()=>[e(d,{label:"点名",prop:"tagName"},{default:t(()=>[e(o,{modelValue:i.value.tagName,"onUpdate:modelValue":l[0]||(l[0]=u=>i.value.tagName=u),readonly:T(g)(i.value?.tagId),clearable:""},null,8,["modelValue","readonly"])]),_:1})]),_:1}),e(y,{sm:24},{default:t(()=>[e(d,{label:"点标题",prop:"tagTitle"},{default:t(()=>[e(o,{modelValue:i.value.tagTitle,"onUpdate:modelValue":l[1]||(l[1]=u=>i.value.tagTitle=u),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(y,{sm:24},{default:t(()=>[e(d,{label:"点长名",prop:"longName"},{default:t(()=>[e(o,{modelValue:i.value.longName,"onUpdate:modelValue":l[2]||(l[2]=u=>i.value.longName=u),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(y,{sm:24},{default:t(()=>[e(d,{label:"点类型",prop:"tagType"},{default:t(()=>[e(x,{modelValue:i.value.tagType,"onUpdate:modelValue":l[3]||(l[3]=u=>i.value.tagType=u)},{default:t(()=>[e(p,{label:"单精度浮点型(Float)",value:1}),e(p,{label:"双精度浮点型(Double)",value:2}),e(p,{label:"8位整型(Byte)",value:3}),e(p,{label:"16位整型(Short)",value:4}),e(p,{label:"32位整型(Int)",value:5}),e(p,{label:"64位整型(Long)",value:6}),e(p,{label:"布尔型(Bool)",value:7}),e(p,{label:"字符串(String)",value:8})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])),[[C,a.value]])}}},xe={__name:"CollectorTag",setup(J,{expose:U}){const S=E.service.hdb,R=q("formRef"),g=q("tableRef"),w=I(!1),z=I(!1),k=I([]),V=D("id",null),_=I(null);Y("tagId",_);const a=ee({loading:!1,open:!1,params:{total:0,page:1,size:E.pageInfo.pageSize,expressions:[{field:"tagName",query:"like",value:""},{field:"tagTitle",query:"like",value:""},{field:"collectorId",query:"eq",value:V.value}],sorts:[]}}),c=()=>{w.value=!0,fe(a.params).then(l=>{w.value=!1,l.success?(k.value=l.value.records,a.params.total=l.value.total,a.params.page=l.value.current):(k.value=[],v({message:l?.exception||l?.msg||"操作失败！",type:"error"}))})},i=()=>{_.value=null,z.value=!0},N=l=>{_.value=l.tagId,z.value=!0},$=l=>{w.value=!0,ve({id:l.tagId}).then(o=>{w.value=!1,o.success?(v({message:"删除成功",type:"success"}),c()):v({message:o?.exception||o?.msg||"操作失败！",type:"error"})})},P=()=>{const l=g.value.getSelectionRows();if(l.length===0)v({type:"error",message:"请选择要删除的内容？"});else{const o=l.map(d=>d.tagId);w.value=!0,ge(o).then(d=>{w.value=!1,d.success?(v({message:"删除成功",type:"success"}),c()):v({message:d?.exception||d?.msg||"操作失败！",type:"error"})})}},m=l=>{console.log(l)},n=()=>{_.value=null};return Z(V,l=>{l!==null&&(c(),n(),a.params.expressions[2].value=V)},{immediate:!0}),U({reset:n}),(l,o)=>{const d=s("el-input"),y=s("el-form-item"),p=s("el-button"),x=s("el-popconfirm"),h=s("h-upload"),A=s("el-space"),C=s("el-form"),u=s("el-table-column"),K=s("el-table"),L=s("el-pagination"),G=s("h-list-layout"),H=s("h-modal"),Q=O("loading");return B(),le(te,null,[e(G,null,{header:t(()=>[e(C,{inline:!0},{default:t(()=>[e(y,{label:"点名"},{default:t(()=>[e(d,{modelValue:a.params.expressions[0].value,"onUpdate:modelValue":o[0]||(o[0]=f=>a.params.expressions[0].value=f),style:{width:"150px"},clearable:""},null,8,["modelValue"])]),_:1}),e(y,{label:"点标题"},{default:t(()=>[e(d,{modelValue:a.params.expressions[1].value,"onUpdate:modelValue":o[1]||(o[1]=f=>a.params.expressions[1].value=f),style:{width:"150px"},clearable:""},null,8,["modelValue"])]),_:1}),e(y,null,{default:t(()=>[e(p,{type:"primary",icon:"Search",round:"",onClick:c},{default:t(()=>[...o[10]||(o[10]=[b("查询",-1)])]),_:1})]),_:1}),e(A,null,{default:t(()=>[e(p,{type:"success",icon:"CirclePlus",onClick:i},{default:t(()=>[...o[11]||(o[11]=[b("新增",-1)])]),_:1}),e(x,{title:"确定要删除吗？",onConfirm:o[2]||(o[2]=f=>P())},{reference:t(()=>[e(p,{type:"danger",icon:"Remove"},{default:t(()=>[...o[12]||(o[12]=[b("删除",-1)])]),_:1})]),_:1}),e(h,{action:T(S)+"/hdb/collector-tag/import",templateUrl:"/hdb/collector-tag/template",onClose:m,data:{collectorId:T(V)}},{default:t(()=>[...o[13]||(o[13]=[b("导入",-1)])]),_:1},8,["action","data"])]),_:1})]),_:1})]),main:t(()=>[M((B(),j(K,{ref_key:"tableRef",ref:g,style:{width:"100%"},height:"100%",data:k.value,"highlight-current-row":"",stripe:"","show-overflow-tooltip":""},{default:t(()=>[e(u,{fixed:"left",type:"selection",width:"40"}),e(u,{prop:"tagName",label:"点名","min-width":"120"}),e(u,{prop:"tagTitle",label:"点标题","min-width":"120"}),e(u,{prop:"longName",label:"点长名","min-width":"120"}),e(u,{prop:"tagType",label:"点类型","min-width":"80"},{default:t(f=>[b(X(l.$dataTypeFormat(f.row.tagType)),1)]),_:1}),e(u,{prop:"action",label:"操作","min-width":100,fixed:"right",align:"center"},{default:t(f=>[e(p,{type:"primary",size:"small",title:"编辑",icon:"Edit",onClick:W=>N(f.row),circle:""},null,8,["onClick"]),e(x,{title:"确定要删除吗？",onConfirm:W=>$(f.row)},{reference:t(()=>[e(p,{type:"danger",size:"small",title:"删除",icon:"Remove",circle:""})]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[Q,w.value]])]),footer:t(()=>[e(L,{"current-page":a.params.page,"onUpdate:currentPage":o[3]||(o[3]=f=>a.params.page=f),"page-size":a.params.size,"onUpdate:pageSize":o[4]||(o[4]=f=>a.params.size=f),total:a.params.total,layout:T(E).pageInfo.layout,"page-sizes":T(E).pageInfo.pageSizes,"pager-count":5,onChange:c,background:"",size:"small"},null,8,["current-page","page-size","total","layout","page-sizes"])]),_:1}),e(H,{modelValue:z.value,"onUpdate:modelValue":o[8]||(o[8]=f=>z.value=f),title:"采集点信息",width:"400",onClose:o[9]||(o[9]=f=>R.value?.reset())},{footer:t(()=>[e(p,{onClick:o[5]||(o[5]=()=>z.value=!1)},{default:t(()=>[...o[14]||(o[14]=[b("关闭",-1)])]),_:1}),e(p,{type:"primary",onClick:o[6]||(o[6]=()=>R.value?.save())},{default:t(()=>[...o[15]||(o[15]=[b("保存",-1)])]),_:1}),e(p,{type:"primary",onClick:o[7]||(o[7]=()=>R.value?.saveAndAdd())},{default:t(()=>[...o[16]||(o[16]=[b("保存并新增",-1)])]),_:1})]),default:t(()=>[e(Ve,{ref_key:"formRef",ref:R,onOnSave:c},null,512)]),_:1},8,["modelValue"])],64)}}},ze={__name:"Collector",setup(J){const U=q("formRef"),S=q("tagRef"),R=q("tableRef"),g=I(!1),w=I(!1),z=I(!1),k=I([]),V=I(null);Y("id",V);const _=I(null);Y("code",_);const a=ee({loading:!1,open:!1,params:{total:0,page:1,size:E.pageInfo.pageSize,expressions:[{field:"collectorCode",query:"like",value:""},{field:"collectorName",query:"like",value:""},{field:"online",query:"in",value:null}],sorts:[]}}),c=()=>{g.value=!0,_e(a.params).then(n=>{g.value=!1,n.success?(k.value=n.value.records,a.params.total=n.value.total,a.params.page=n.value.current):(k.value=[],v({message:n?.exception||n?.msg||"操作失败！",type:"error"}))})},i=()=>{V.value=null,_.value=null,w.value=!0},N=n=>{V.value=n.collectorId,_.value=n.collectorCode,w.value=!0},$=n=>{V.value=n.collectorId,_.value=n.collectorCode,z.value=!0},P=n=>{g.value=!0,be({id:n.collectorId}).then(l=>{g.value=!1,l.success?(v({message:"删除成功",type:"success"}),c()):v({message:l?.exception||l?.msg||"操作失败！",type:"error"})})},m=()=>{const n=R.value.getSelectionRows();if(n.length===0)v({type:"error",message:"请选择要删除的内容？"});else{const l=n.map(o=>o.collectorId);g.value=!0,ye(l).then(o=>{g.value=!1,o.success?(v({message:"删除成功",type:"success"}),c()):v({message:o?.exception||o?.msg||"操作失败！",type:"error"})})}};return ne(()=>{c()}),(n,l)=>{const o=s("el-option"),d=s("el-select"),y=s("el-form-item"),p=s("el-input"),x=s("el-button"),h=s("el-popconfirm"),A=s("el-space"),C=s("el-form"),u=s("el-table-column"),K=s("h-icon"),L=s("el-switch"),G=s("el-table"),H=s("el-pagination"),Q=s("h-list-layout"),f=s("h-modal"),W=O("loading");return B(),le(te,null,[e(Q,null,{header:t(()=>[e(C,{inline:!0},{default:t(()=>[e(y,{label:"状态"},{default:t(()=>[e(d,{modelValue:a.params.expressions[2].value,"onUpdate:modelValue":l[0]||(l[0]=r=>a.params.expressions[2].value=r),style:{width:"150px"},clearable:""},{default:t(()=>[e(o,{value:1,label:"在线"}),e(o,{value:0,label:"离线"})]),_:1},8,["modelValue"])]),_:1}),e(y,{label:"采集器编码"},{default:t(()=>[e(p,{modelValue:a.params.expressions[0].value,"onUpdate:modelValue":l[1]||(l[1]=r=>a.params.expressions[0].value=r),style:{width:"150px"},clearable:""},null,8,["modelValue"])]),_:1}),e(y,{label:"采集器名称"},{default:t(()=>[e(p,{modelValue:a.params.expressions[1].value,"onUpdate:modelValue":l[2]||(l[2]=r=>a.params.expressions[1].value=r),style:{width:"150px"},clearable:""},null,8,["modelValue"])]),_:1}),e(y,null,{default:t(()=>[e(x,{type:"primary",icon:"Search",round:"",onClick:c},{default:t(()=>[...l[12]||(l[12]=[b("查询",-1)])]),_:1})]),_:1}),e(A,null,{default:t(()=>[e(x,{type:"success",icon:"CirclePlus",onClick:i},{default:t(()=>[...l[13]||(l[13]=[b("新增",-1)])]),_:1}),e(h,{title:"确定要删除吗？",onConfirm:l[3]||(l[3]=r=>m())},{reference:t(()=>[e(x,{type:"danger",icon:"Remove"},{default:t(()=>[...l[14]||(l[14]=[b("删除",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),main:t(()=>[M((B(),j(G,{ref_key:"tableRef",ref:R,style:{width:"100%"},height:"100%",data:k.value,"highlight-current-row":"",stripe:"","show-overflow-tooltip":""},{default:t(()=>[e(u,{fixed:"left",type:"selection",width:"40"}),e(u,{fixed:"left",prop:"online",width:"50"},{default:t(r=>[e(K,{title:r.row.online?"在线":"离线",type:"browserlist_light",style:se({fontSize:"20px",color:r.row.online?"var(--el-color-success)":"var(--el-text-color-secondary)"})},null,8,["title","style"])]),_:1}),e(u,{prop:"collectorCode",label:"编码","min-width":"120"}),e(u,{prop:"collectorName",label:"名称","min-width":"120"}),e(u,{prop:"collectorAccount",label:"连接账号","min-width":"120"}),e(u,{prop:"collectorPassword",label:"连接密码","min-width":"120"}),e(u,{prop:"status",label:"状态","min-width":"80"},{default:t(r=>[e(L,{modelValue:r.row.collectorEnable,"onUpdate:modelValue":F=>r.row.collectorEnable=F,"inline-prompt":"","active-value":1,"inactive-value":0,"active-text":"启用","inactive-text":"禁用","before-change":()=>!1,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(u,{prop:"createBy",label:"创建人","min-width":"100"}),e(u,{prop:"createAt",label:"创建时间","min-width":"180"},{default:t(r=>[b(X(n.$defaultDateTimeFormat(r.row.createAt)),1)]),_:1}),e(u,{prop:"updateBy",label:"最后修改人","min-width":"100"}),e(u,{prop:"updateAt",label:"最后修改时间","min-width":"180"},{default:t(r=>[b(X(n.$defaultDateTimeFormat(r.row.updateAt)),1)]),_:1}),e(u,{prop:"action",label:"操作","min-width":150,fixed:"right",align:"center"},{default:t(r=>[e(x,{type:"primary",size:"small",title:"编辑",icon:"Edit",onClick:F=>N(r.row),circle:""},null,8,["onClick"]),e(x,{type:"primary",size:"small",title:"采集点",icon:"CollectionTag",onClick:F=>$(r.row),circle:""},null,8,["onClick"]),e(h,{title:"确定要删除吗？",onConfirm:F=>P(r.row)},{reference:t(()=>[e(x,{type:"danger",size:"small",title:"删除",icon:"Remove",circle:""})]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[W,g.value]])]),footer:t(()=>[e(H,{"current-page":a.params.page,"onUpdate:currentPage":l[4]||(l[4]=r=>a.params.page=r),"page-size":a.params.size,"onUpdate:pageSize":l[5]||(l[5]=r=>a.params.size=r),total:a.params.total,layout:T(E).pageInfo.layout,"page-sizes":T(E).pageInfo.pageSizes,"pager-count":5,onChange:c,background:"",size:"small"},null,8,["current-page","page-size","total","layout","page-sizes"])]),_:1}),e(f,{modelValue:w.value,"onUpdate:modelValue":l[8]||(l[8]=r=>w.value=r),title:"采集器信息",width:"400",onClose:l[9]||(l[9]=r=>U.value?.reset())},{footer:t(()=>[e(x,{onClick:l[6]||(l[6]=()=>w.value=!1)},{default:t(()=>[...l[15]||(l[15]=[b("关闭",-1)])]),_:1}),e(x,{type:"primary",onClick:l[7]||(l[7]=()=>U.value?.save())},{default:t(()=>[...l[16]||(l[16]=[b("保存",-1)])]),_:1})]),default:t(()=>[e(we,{ref_key:"formRef",ref:U,onOnSave:c},null,512)]),_:1},8,["modelValue"]),e(f,{modelValue:z.value,"onUpdate:modelValue":l[10]||(l[10]=r=>z.value=r),title:"采集器信息",width:"100%",onClose:l[11]||(l[11]=r=>S.value?.reset())},{default:t(()=>[e(xe,{ref_key:"tagRef",ref:S},null,512)]),_:1},8,["modelValue"])],64)}}};export{ze as default};
