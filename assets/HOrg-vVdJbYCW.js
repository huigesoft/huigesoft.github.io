import{_ as re,q as i,v as se,D as ie,r as d,n as pe,p as me,g as fe,o as B,w as o,x as l,b as m,h as V,c as ve,a as ce,t as _e,L as ge,H as Ve,E as k}from"./index-CLxOXX9K.js";import{o as be,s as ye,d as ke,g as xe}from"./org-BBFmx87C.js";const he={class:"dialog-footer"},Ce={class:"custom-tree-node"},we={key:0},Ne={__name:"HOrg",setup(Ue){const H={parentId:[{required:!0,message:"上级机构不能为空！",trigger:"change"}],orgCode:[{required:!0,message:"编码不能为空！",trigger:"blur"}],orgName:[{required:!0,message:"名称不能为空！",trigger:"blur"}]},v=i(!1),c=i(!1),x=i(null),N=i(null),_=i(null),U=i(null),g=i([]),b=i(null),E=i(null),p=i([]),n=i({}),T={value:"key",label:"title",children:"children"},h=i(300),I=se(()=>g?.value&&g?.value.length>0?g.value:[{key:"root",title:"组织机构管理",label:"组织机构管理",value:"root",children:g.value}]),y=()=>{be({}).then(a=>{a.success&&a.value?.length>0&&(g.value=a.value,p.value.length===0&&(O(a.value,p.value),ge(()=>{x.value.setExpandedKeys(p.value)})))})},O=(a,e)=>{if(a?.length>0)for(let u of a)e.push(u.key),O(u.children,e)},$=a=>{x.value?.filter(a)},q=(a,e)=>e.title?.includes(a),K=()=>{Ve(N.value.$el,a=>{const e=a[0],{height:u}=e.contentRect;u-50<200&&(h.value=200),h.value=u-50})},j=a=>{a.key!=="root"&&F(a.key)},z=a=>{E.value=a.key},F=a=>{v.value=!0,xe({id:a}).then(e=>{v.value=!1,e.success&&(n.value=e.value,_.value.clearValidate())})},M=()=>{_.value.validate().then(()=>{v.value=!0,ye(n.value).then(a=>{v.value=!1,a.success&&(k.success({message:"保存成功"}),y())})})},S=()=>{_.value.resetFields()},L=a=>{_.value.resetFields(),n.value={parentId:a.key,orgEnable:1}},P=a=>{c.value=!0,b.value=a},W=()=>{c.value=!1,b.value!==null&&(b.value?.children?.length>0?k.error({message:"包含子菜单，无法删除！"}):ke({id:b.value.key}).then(a=>{a.success?(y(),k.success({message:"删除成功！"})):k.error({message:"删除失败！"+a.exception})}))},A=a=>{p.value.findIndex(u=>u===a.key)===-1&&p.value.push(a.key)},G=a=>{const e=p.value.findIndex(u=>u===a.key);e>-1&&p.value.splice(e,1)};return ie(()=>{y(),K()}),(a,e)=>{const u=d("el-input"),f=d("el-button"),J=d("el-dialog"),Q=d("h-icon"),C=d("el-dropdown-item"),X=d("el-dropdown-menu"),Y=d("el-dropdown"),Z=d("el-tree-v2"),D=d("el-card"),ee=d("el-tree-select"),s=d("el-form-item"),r=d("h-col"),le=d("el-input-number"),oe=d("el-switch"),ae=d("el-space"),te=d("el-row"),ne=d("el-form"),ue=d("h-split-h"),de=pe("loading");return me((B(),fe(ue,{leftWidth:260},{left:o(()=>[l(D,{ref_key:"leftCard",ref:N,class:"card",shadow:"never","body-style":{height:"calc(100% - 40px)"}},{header:o(()=>[l(u,{size:"small","prefix-icon":"Search",modelValue:U.value,"onUpdate:modelValue":e[0]||(e[0]=t=>U.value=t),clearable:"",placeholder:"请输入",onInput:$},null,8,["modelValue"])]),default:o(()=>[l(J,{modelValue:c.value,"onUpdate:modelValue":e[2]||(e[2]=t=>c.value=t),width:"300"},{footer:o(()=>[V("div",he,[l(f,{onClick:e[1]||(e[1]=t=>c.value=!1)},{default:o(()=>[...e[17]||(e[17]=[m("取消",-1)])]),_:1}),l(f,{type:"primary",onClick:W},{default:o(()=>[...e[18]||(e[18]=[m(" 确认 ",-1)])]),_:1})])]),default:o(()=>[e[19]||(e[19]=V("span",null,"确定要删除吗？",-1))]),_:1},8,["modelValue"]),l(Z,{ref_key:"treeRef",ref:x,props:T,data:I.value,"filter-method":q,"expand-on-click-node":!1,"highlight-current":"","default-expand-all":"","default-expanded-keys":p.value,height:h.value,onNodeClick:j,onCurrentChange:z,onNodeExpand:A,onNodeCollapse:G},{default:o(({node:t,data:w})=>[V("span",Ce,[V("span",null,[V("span",null,[l(Q,{type:"apartment"})]),m(" "+_e(t.label),1)]),E.value===w.key?(B(),ve("span",we,[l(Y,{placement:"bottom-start"},{dropdown:o(()=>[l(X,null,{default:o(()=>[l(C,{icon:"CirclePlus",onClick:R=>L(w)},{default:o(()=>[...e[20]||(e[20]=[m("添加",-1)])]),_:1},8,["onClick"]),l(C,{icon:"Remove",onClick:R=>P(w)},{default:o(()=>[...e[21]||(e[21]=[m("删除",-1)])]),_:1},8,["onClick"]),l(C,{icon:"Refresh",onClick:e[3]||(e[3]=R=>y())},{default:o(()=>[...e[22]||(e[22]=[m(" 刷新 ",-1)])]),_:1})]),_:2},1024)]),default:o(()=>[l(f,{size:"small",link:"",icon:"MoreFilled"})]),_:2},1024)])):ce("",!0)])]),_:1},8,["data","default-expanded-keys","height"])]),_:1},512)]),right:o(()=>[l(D,{shadow:"never",header:"详情",class:"card not-select","body-style":{height:"calc(100% - 35px)",overflow:"auto"}},{default:o(()=>[l(ne,{ref_key:"formRef",ref:_,model:n.value,"label-width":"120px",rules:H,"label-suffix":"："},{default:o(()=>[l(te,{gutter:10},{default:o(()=>[l(r,null,{default:o(()=>[l(s,{label:"上级组织",prop:"parentId"},{default:o(()=>[l(ee,{modelValue:n.value.parentId,"onUpdate:modelValue":e[4]||(e[4]=t=>n.value.parentId=t),"check-strictly":"",data:I.value},null,8,["modelValue","data"])]),_:1})]),_:1}),l(r,null,{default:o(()=>[l(s,{label:"机构编码",prop:"orgCode"},{default:o(()=>[l(u,{modelValue:n.value.orgCode,"onUpdate:modelValue":e[5]||(e[5]=t=>n.value.orgCode=t),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(r,null,{default:o(()=>[l(s,{label:"机构名称",prop:"orgName"},{default:o(()=>[l(u,{modelValue:n.value.orgName,"onUpdate:modelValue":e[6]||(e[6]=t=>n.value.orgName=t),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(r,null,{default:o(()=>[l(s,{label:"机构简称",prop:"shortName"},{default:o(()=>[l(u,{modelValue:n.value.shortName,"onUpdate:modelValue":e[7]||(e[7]=t=>n.value.shortName=t),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(r,{sm:24},{default:o(()=>[l(s,{label:"机构描述",prop:"orgDesc"},{default:o(()=>[l(u,{modelValue:n.value.orgDesc,"onUpdate:modelValue":e[8]||(e[8]=t=>n.value.orgDesc=t),type:"textarea",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(r,null,{default:o(()=>[l(s,{label:"排序号",prop:"orgOrder"},{default:o(()=>[l(le,{style:{width:"100%"},modelValue:n.value.orgOrder,"onUpdate:modelValue":e[9]||(e[9]=t=>n.value.orgOrder=t)},null,8,["modelValue"])]),_:1})]),_:1}),l(r,null,{default:o(()=>[l(s,{label:"是否启用",prop:"orgEnable"},{default:o(()=>[l(oe,{"active-value":1,"inactive-value":0,modelValue:n.value.orgEnable,"onUpdate:modelValue":e[10]||(e[10]=t=>n.value.orgEnable=t)},null,8,["modelValue"])]),_:1})]),_:1}),l(r,null,{default:o(()=>[l(s,{label:"机构地址",prop:"address"},{default:o(()=>[l(u,{modelValue:n.value.address,"onUpdate:modelValue":e[11]||(e[11]=t=>n.value.address=t),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(r,null,{default:o(()=>[l(s,{label:"固定电话",prop:"telephone"},{default:o(()=>[l(u,{modelValue:n.value.telephone,"onUpdate:modelValue":e[12]||(e[12]=t=>n.value.telephone=t),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(r,null,{default:o(()=>[l(s,{label:"电子邮件",prop:"email"},{default:o(()=>[l(u,{modelValue:n.value.email,"onUpdate:modelValue":e[13]||(e[13]=t=>n.value.email=t),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(r,null,{default:o(()=>[l(s,{label:"联系人",prop:"contacts"},{default:o(()=>[l(u,{modelValue:n.value.contacts,"onUpdate:modelValue":e[14]||(e[14]=t=>n.value.contacts=t),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(r,null,{default:o(()=>[l(s,{label:"传真",prop:"faxNo"},{default:o(()=>[l(u,{modelValue:n.value.faxNo,"onUpdate:modelValue":e[15]||(e[15]=t=>n.value.faxNo=t),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(r,null,{default:o(()=>[l(s,{label:"音位码",prop:"faxNo"},{default:o(()=>[l(u,{modelValue:n.value.phonemeCode,"onUpdate:modelValue":e[16]||(e[16]=t=>n.value.phonemeCode=t),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(r,{style:{"text-align":"center"},sm:24},{default:o(()=>[l(ae,null,{default:o(()=>[l(f,{onClick:S},{default:o(()=>[...e[23]||(e[23]=[m("重置",-1)])]),_:1}),l(f,{type:"primary",onClick:M},{default:o(()=>[...e[24]||(e[24]=[m("保存",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})),[[de,v.value]])}}},Oe=re(Ne,[["__scopeId","data-v-4181f74c"]]);export{Oe as default};
