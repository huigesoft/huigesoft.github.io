import{I as ae,N as K,q as i,v as F,D as Q,r,c as $,o as h,x as l,w as t,F as D,G as se,g as B,b as m,t as L,E as I,z as J,_ as Ue,s as Ce,f as G,n as ze,p as Re,h as le,a as te,L as Se,H as Oe,K as W}from"./index-CLxOXX9K.js";import{n as Pe,a as ne,o as Ne,p as Te,b as oe}from"./org-BBFmx87C.js";import{l as re}from"./post-iWp8M4en.js";import{_ as $e}from"./UserForm-BdQ_pceg.js";import"./utils-B5efKl0g.js";import"./HInit-vly2qBM9.js";const De={__name:"AddUser",emits:["onSave"],setup(X,{expose:V,emit:x}){const O=x,b=ae("orgId",null),w=K([]),U=K([]),f=i([]),p=i([]),u=i({}),C=()=>{Pe({orgId:b.value}).then(s=>{if(s.success){const c=s.value;w.value=c;for(let n=0;n<c.length;n++){const y=c[n];u.value[y.userId]=y.username+"["+y.realname+"]"}}})},z=()=>{re({sorts:[{field:"postOrder"}]}).then(s=>{s.success&&(U.value=s.value)})},P=F(()=>w.value.map(s=>({value:s.userId,label:s.username+"["+s.realname+"]"}))),N=F(()=>U.value.map(s=>({value:s.postId,label:s.postName}))),_=()=>{ne(p.value).then(s=>{s?.success?(I({message:"保存成功！",type:"success"}),O("onSave")):I({message:s?.exception||s?.msg||"操作失败！",type:"error"})})},R=s=>{if(s.length>0){const c=s[s.length-1];p.value.findIndex(n=>n.userId===c)===-1&&p.value.push({orgId:b.value,userId:c,postId:null})}},S=s=>{p.value.splice(p.value.findIndex(c=>c.userId===s),1)};return Q(()=>{C(),z()}),V({save:_}),(s,c)=>{const n=r("el-select-v2"),y=r("el-col"),H=r("el-row");return h(),$(D,null,[l(H,{gutter:20},{default:t(()=>[l(y,{span:24},{default:t(()=>[l(n,{modelValue:f.value,"onUpdate:modelValue":c[0]||(c[0]=E=>f.value=E),onRemoveTag:S,onChange:R,filterable:"",options:P.value,placeholder:"选择用户",multiple:""},null,8,["modelValue","options"])]),_:1})]),_:1}),(h(!0),$(D,null,se(p.value,(E,T)=>(h(),B(H,{key:T,style:{margin:"10px"}},{default:t(()=>[l(y,{span:10},{default:t(()=>[m(L(u.value[E.userId]),1)]),_:2},1024),l(y,{span:14},{default:t(()=>[l(n,{modelValue:p.value[T].postId,"onUpdate:modelValue":M=>p.value[T].postId=M,filterable:"",options:N.value,placeholder:"选择岗位"},null,8,["modelValue","onUpdate:modelValue","options"])]),_:2},1024)]),_:2},1024))),128))],64)}}},Ee={__name:"UserPost",emits:["onSave"],setup(X,{expose:V,emit:x}){const O=x,b=K([]),w=ae("userPosts",[]),U=F(()=>b.value.map(u=>({value:u.postId,label:u.postName}))),f=()=>{re({sorts:[{field:"postOrder"}]}).then(u=>{u.success&&(b.value=u.value)})},p=()=>{ne(w.value).then(u=>{u?.success?(I({message:"保存成功！",type:"success"}),O("onSave")):I({message:u?.exception||u?.msg||"操作失败！",type:"error"})})};return Q(()=>{f()}),V({save:p}),(u,C)=>{const z=r("el-col"),P=r("el-select-v2"),N=r("el-row");return h(!0),$(D,null,se(J(w),(_,R)=>(h(),B(N,{key:R,style:{margin:"10px"}},{default:t(()=>[l(z,{span:10},{default:t(()=>[m(L(_.uname),1)]),_:2},1024),l(z,{span:14},{default:t(()=>[l(P,{modelValue:_.postId,"onUpdate:modelValue":S=>_.postId=S,filterable:"",options:U.value,placeholder:"选择岗位"},null,8,["modelValue","onUpdate:modelValue","options"])]),_:2},1024)]),_:2},1024))),128)}}},qe={__name:"OrgUser",setup(X){const V=i(null),x=i(null),O=i(null),b=i(null),w=i(null),U=i(null),f=i(!1),p=i(!1),u=i(!1),C=i(!1),z=i(null),P=i(null),N=i(null),_=i([]),R=K([]),S=i([]),s=i([]);W("orgId",N),W("id",U),W("userPosts",S);const c={value:"key",label:"title",children:"children"},n=Ce({loading:!1,open:!1,params:{total:0,page:1,size:G.pageInfo.pageSize,expressions:[{field:"username",query:"like",value:""},{field:"nickname",query:"like",value:""},{field:"orgId",query:"eq",value:""}],sorts:[{field:"username"}]}}),y=i(300),H=F(()=>_?.value&&_?.value.length>0?_.value:[{key:"root",title:"组织机构管理",label:"组织机构管理",value:"root",children:_.value}]),E=()=>{Ne({}).then(o=>{o.success&&(_.value=o.value,s.value.length===0&&(T(o.value,s.value),Se(()=>{V.value.setExpandedKeys(s.value)})))})},T=(o,e)=>{if(o?.length>0)for(let d of o)e.push(d.key),T(d.children,e)},M=o=>{V.value?.filter(o)},ue=(o,e)=>e.title?.includes(o),ie=()=>{Oe(z.value.$el,o=>{const e=o[0],{height:d}=e.contentRect;d-50<200&&(y.value=200),y.value=d-50})},k=()=>{p.value=!1,f.value=!0,Te(n.params).then(o=>{f.value=!1,o.success?(R.value=o.value.records,n.params.total=o.value.total,n.params.page=o.value.current):(R.value=[],I({message:o?.exception||o?.msg||"操作失败！",type:"error"}))})},de=()=>{p.value=!0},pe=o=>{const e=[o.orgUserId];f.value=!0,oe(e).then(d=>{f.value=!1,d.success?(I({message:"移除成功",type:"success"}),k()):I({message:d?.exception||d?.msg||"操作失败！",type:"error"})})},me=()=>{const o=x.value.getSelectionRows();if(o.length===0)I({type:"error",message:"请选择要删除的内容？"});else{const e=o.map(d=>d.orgUserId);f.value=!0,oe(e).then(d=>{f.value=!1,d.success?(I({message:"移除成功",type:"success"}),k()):I({message:d?.exception||d?.msg||"操作失败！",type:"error"})})}},ce=o=>{o.key!=="root"&&(N.value=o.key,n.params.expressions[2].value=o.key,k())},ve=o=>{U.value=o.userId,C.value=!0},fe=()=>{const o=x.value.getSelectionRows();S.value=o.map(e=>({orgUserId:e.orgUserId,orgId:e.orgId,userId:e.userId,postId:e.postId,uname:e.username+"["+e.realname+"]"})),u.value=!0},ge=o=>{S.value=[{orgUserId:o.orgUserId,orgId:o.orgId,userId:o.userId,postId:o.postId,uname:o.username+"["+o.realname+"]"}],u.value=!0};return Q(()=>{E(),ie()}),(o,e)=>{const d=r("el-input"),Y=r("h-icon"),_e=r("el-tree-v2"),Z=r("el-card"),j=r("el-form-item"),v=r("el-button"),ee=r("el-popconfirm"),ye=r("el-space"),he=r("el-form"),g=r("el-table-column"),Ie=r("el-switch"),be=r("el-table"),we=r("el-pagination"),ke=r("h-list-layout"),Ve=r("h-split-h"),A=r("h-modal"),xe=ze("loading");return h(),$(D,null,[l(Ve,{leftWidth:260,handlerShow:!0},{left:t(()=>[l(Z,{ref_key:"leftCard",ref:z,class:"card",shadow:"never","body-style":{height:"calc(100% - 40px)"}},{header:t(()=>[l(d,{size:"small","prefix-icon":"Search",modelValue:P.value,"onUpdate:modelValue":e[0]||(e[0]=a=>P.value=a),clearable:"",placeholder:"请输入",onInput:M},null,8,["modelValue"])]),default:t(()=>[l(_e,{ref_key:"treeRef",ref:V,props:c,data:H.value,"filter-method":ue,"expand-on-click-node":!1,"highlight-current":"","default-expanded-keys":s.value,height:y.value,onNodeClick:ce},{default:t(({node:a,data:q})=>[le("span",null,[le("span",null,[l(Y,{type:"apartment"})]),m(" "+L(a.label),1)])]),_:1},8,["data","default-expanded-keys","height"])]),_:1},512)]),right:t(()=>[l(Z,{shadow:"never",header:"详情",class:"card not-select","body-style":{height:"calc(100% - 35px)",overflow:"auto"}},{default:t(()=>[l(ke,null,{header:t(()=>[l(he,{inline:!0},{default:t(()=>[l(j,{label:"用户名"},{default:t(()=>[l(d,{modelValue:n.params.expressions[0].value,"onUpdate:modelValue":e[1]||(e[1]=a=>n.params.expressions[0].value=a),style:{width:"150px"},clearable:""},null,8,["modelValue"])]),_:1}),l(j,{label:"昵称"},{default:t(()=>[l(d,{modelValue:n.params.expressions[1].value,"onUpdate:modelValue":e[2]||(e[2]=a=>n.params.expressions[1].value=a),style:{width:"150px"},clearable:""},null,8,["modelValue"])]),_:1}),l(j,null,{default:t(()=>[l(v,{type:"primary",icon:"Search",round:"",onClick:k},{default:t(()=>[...e[16]||(e[16]=[m("查询",-1)])]),_:1})]),_:1}),l(ye,null,{default:t(()=>[l(v,{type:"success",icon:"CirclePlus",onClick:de},{default:t(()=>[...e[17]||(e[17]=[m("邀请",-1)])]),_:1}),l(ee,{title:"确定要移除吗？",onConfirm:e[3]||(e[3]=a=>me())},{reference:t(()=>[l(v,{type:"danger",icon:"Remove"},{default:t(()=>[...e[18]||(e[18]=[m("移除",-1)])]),_:1})]),_:1}),l(v,{type:"primary",icon:"Postcard",onClick:fe},{default:t(()=>[...e[19]||(e[19]=[m("岗位",-1)])]),_:1})]),_:1})]),_:1})]),main:t(()=>[Re((h(),B(be,{ref_key:"tableRef",ref:x,style:{width:"100%"},height:"100%",data:R.value,"highlight-current-row":"",stripe:"","show-overflow-tooltip":""},{default:t(()=>[l(g,{type:"selection",width:"40",fixed:"left"}),l(g,{prop:"username",label:"用户名","min-width":"120"}),l(g,{prop:"nickname",label:"昵称","min-width":"120"}),l(g,{prop:"realname",label:"真实姓名","min-width":"120"}),l(g,{prop:"postName",label:"岗位","min-width":"120"}),l(g,{prop:"gender",label:"性别","min-width":"80"},{default:t(a=>[a.row.gender===1?(h(),$(D,{key:0},[m(" 男 ")],64)):(h(),$(D,{key:1},[m(L(a.row.gender===2?"女":"未知"),1)],64))]),_:1}),l(g,{prop:"phone",label:"电话号码","min-width":"120"}),l(g,{prop:"email",label:"电子邮件","min-width":"200"}),l(g,{prop:"status",label:"状态","min-width":"80"},{default:t(a=>[l(Ie,{modelValue:a.row.status,"onUpdate:modelValue":q=>a.row.status=q,"inline-prompt":"","active-value":1,"inactive-value":0,"active-text":"启用","inactive-text":"禁用","before-change":()=>!1,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(g,{prop:"expireTime",label:"过期时间","min-width":"180"}),l(g,{prop:"sessionTime",label:"会话有效期","min-width":"120"}),l(g,{prop:"action",label:"操作","min-width":140,fixed:"right",align:"center"},{default:t(a=>[l(v,{type:"primary",size:"small",title:"编辑",onClick:q=>ve(a.row),icon:"Edit",circle:""},null,8,["onClick"]),l(v,{type:"primary",size:"small",title:"岗位",onClick:q=>ge(a.row),icon:"Postcard",circle:""},null,8,["onClick"]),l(ee,{title:"确定要移除吗？",onConfirm:q=>pe(a.row)},{reference:t(()=>[l(v,{type:"danger",size:"small",title:"移除",icon:"Remove",circle:""})]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[xe,f.value]])]),footer:t(()=>[l(we,{"current-page":n.params.page,"onUpdate:currentPage":e[4]||(e[4]=a=>n.params.page=a),"page-size":n.params.size,"onUpdate:pageSize":e[5]||(e[5]=a=>n.params.size=a),total:n.params.total,layout:J(G).pageInfo.layout,"page-sizes":J(G).pageInfo.pageSizes,"pager-count":5,onChange:k,background:"",size:"small"},null,8,["current-page","page-size","total","layout","page-sizes"])]),_:1})]),_:1})]),_:1}),l(A,{modelValue:p.value,"onUpdate:modelValue":e[8]||(e[8]=a=>p.value=a),title:"邀请用户",type:0,width:"400"},{footer:t(()=>[l(v,{onClick:e[6]||(e[6]=()=>p.value=!1)},{default:t(()=>[...e[20]||(e[20]=[m("取消",-1)])]),_:1}),l(v,{type:"primary",onClick:e[7]||(e[7]=()=>O.value?.save())},{default:t(()=>[...e[21]||(e[21]=[m("保存",-1)])]),_:1})]),default:t(()=>[p.value?(h(),B(De,{key:0,ref_key:"addRef",ref:O,onOnSave:k},null,512)):te("",!0)]),_:1},8,["modelValue"]),l(A,{modelValue:C.value,"onUpdate:modelValue":e[11]||(e[11]=a=>C.value=a),title:"用户信息",width:"800",onClose:e[12]||(e[12]=a=>b.value?.reset())},{footer:t(()=>[l(v,{onClick:e[9]||(e[9]=()=>C.value=!1)},{default:t(()=>[...e[22]||(e[22]=[m("取消",-1)])]),_:1}),l(v,{type:"primary",onClick:e[10]||(e[10]=()=>b.value?.save())},{default:t(()=>[...e[23]||(e[23]=[m("保存",-1)])]),_:1})]),default:t(()=>[l($e,{ref_key:"formRef",ref:b,onOnSave:k},null,512)]),_:1},8,["modelValue"]),l(A,{modelValue:u.value,"onUpdate:modelValue":e[15]||(e[15]=a=>u.value=a),title:"岗位信息",width:"400"},{footer:t(()=>[l(v,{onClick:e[13]||(e[13]=()=>u.value=!1)},{default:t(()=>[...e[24]||(e[24]=[m("取消",-1)])]),_:1}),l(v,{type:"primary",onClick:e[14]||(e[14]=()=>w.value?.save())},{default:t(()=>[...e[25]||(e[25]=[m("保存",-1)])]),_:1})]),default:t(()=>[u.value?(h(),B(Ee,{key:0,ref_key:"postRef",ref:w,onOnSave:k},null,512)):te("",!0)]),_:1},8,["modelValue"])],64)}}},je=Ue(qe,[["__scopeId","data-v-bb2103f6"]]);export{je as default};
