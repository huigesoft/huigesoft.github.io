import{I as M,q as f,J as T,r as s,n as O,p as P,g as B,o as N,w as t,x as l,E as v,s as J,f as R,D as K,c as L,z as S,b as x,F as A,K as G}from"./index-CLxOXX9K.js";import{s as H,g as Q,c as W,p as X,d as Y,a as Z}from"./post-iWp8M4en.js";import{u as ee}from"./utils-B5efKl0g.js";const le={__name:"PostForm",emits:["onSave"],setup(E,{expose:b,emit:V}){const m=V,{hasText:g}=ee(),w={postCode:[{validator:async(e,o)=>{if(!g(o))return Promise.reject("请输入岗位代码");const d={postCode:o,idValue:a.value.postId,id:"postId"};await W(d).then(u=>u.value?Promise.reject("岗位代码已存在！"):Promise.resolve())},trigger:"blur"}],postName:[{required:!0,message:"请输入岗位名称",trigger:"blur"}]},n=M("id",null),i=f(!1),k=f(null),a=f({status:1}),z=()=>{Q({id:n.value}).then(e=>{e.success?a.value=e.value:(a.value={},v({message:e?.exception||e?.msg||"操作失败！",type:"error"}))})},I=()=>{k.value.validate().then(()=>{i.value=!0,H(a.value).then(e=>{i.value=!1,e?.success?(a.value=e.value,v({message:"保存成功！",type:"success"}),m("onSave")):v({message:e?.exception||e?.msg||"操作失败！",type:"error"})})})},r=()=>{n.value=null,a.value={status:1}};return T(n,e=>{e!==null&&z()},{immediate:!0}),b({save:I,reset:r}),(e,o)=>{const d=s("el-input"),u=s("el-form-item"),y=s("h-col"),U=s("el-input-number"),h=s("el-row"),_=s("el-form"),D=O("loading");return P((N(),B(_,{ref_key:"formRef",ref:k,model:a.value,"label-width":"120px",rules:w,"label-suffix":"："},{default:t(()=>[l(h,{gutter:10},{default:t(()=>[l(y,{sm:24},{default:t(()=>[l(u,{label:"岗位代码",prop:"postCode"},{default:t(()=>[l(d,{modelValue:a.value.postCode,"onUpdate:modelValue":o[0]||(o[0]=c=>a.value.postCode=c),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(y,{sm:24},{default:t(()=>[l(u,{label:"岗位名称",prop:"postName"},{default:t(()=>[l(d,{modelValue:a.value.postName,"onUpdate:modelValue":o[1]||(o[1]=c=>a.value.postName=c),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(y,{sm:24},{default:t(()=>[l(u,{label:"岗位排序号",prop:"postOrder"},{default:t(()=>[l(U,{style:{width:"100%"},modelValue:a.value.postOrder,"onUpdate:modelValue":o[2]||(o[2]=c=>a.value.postOrder=c)},null,8,["modelValue"])]),_:1})]),_:1}),l(y,{sm:24},{default:t(()=>[l(u,{label:"岗位描述",prop:"postDesc"},{default:t(()=>[l(d,{modelValue:a.value.postDesc,"onUpdate:modelValue":o[3]||(o[3]=c=>a.value.postDesc=c),type:"textarea",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])),[[D,i.value]])}}},se={__name:"PostList",setup(E){const b=f(null),V=f(null),m=f(!1),g=f(!1),C=f([]),w=f(null);G("id",w);const n=J({loading:!1,open:!1,params:{total:0,page:1,size:R.pageInfo.pageSize,expressions:[{field:"postCode",query:"like",value:""},{field:"postName",query:"like",value:""}],sorts:[{field:"postOrder"}]}}),i=()=>{m.value=!0,X(n.params).then(r=>{m.value=!1,r.success?(C.value=r.value.records,n.params.total=r.value.total,n.params.page=r.value.current):(C.value=[],v({message:r?.exception||r?.msg||"操作失败！",type:"error"}))})},k=()=>{w.value=null,g.value=!0},a=r=>{w.value=r.postId,g.value=!0},z=r=>{m.value=!0,Y({id:r.postId}).then(e=>{m.value=!1,e.success?(v({message:"删除成功",type:"success"}),i()):v({message:e?.exception||e?.msg||"操作失败！",type:"error"})})},I=()=>{const r=V.value.getSelectionRows();if(r.length===0)v({type:"error",message:"请选择要删除的内容？"});else{const e=r.map(o=>o.postId);m.value=!0,Z(e).then(o=>{m.value=!1,o.success?(v({message:"删除成功",type:"success"}),i()):v({message:o?.exception||o?.msg||"操作失败！",type:"error"})})}};return K(()=>{i()}),(r,e)=>{const o=s("el-input"),d=s("el-form-item"),u=s("el-button"),y=s("el-popconfirm"),U=s("el-space"),h=s("el-form"),_=s("el-table-column"),D=s("el-table"),c=s("el-pagination"),$=s("h-list-layout"),j=s("h-modal"),q=O("loading");return N(),L(A,null,[l($,null,{header:t(()=>[l(h,{inline:!0},{default:t(()=>[l(d,{label:"岗位代码"},{default:t(()=>[l(o,{modelValue:n.params.expressions[0].value,"onUpdate:modelValue":e[0]||(e[0]=p=>n.params.expressions[0].value=p),style:{width:"150px"},clearable:""},null,8,["modelValue"])]),_:1}),l(d,{label:"岗位名称"},{default:t(()=>[l(o,{modelValue:n.params.expressions[1].value,"onUpdate:modelValue":e[1]||(e[1]=p=>n.params.expressions[1].value=p),style:{width:"150px"},clearable:""},null,8,["modelValue"])]),_:1}),l(d,null,{default:t(()=>[l(u,{type:"primary",icon:"Search",round:"",onClick:i},{default:t(()=>[...e[9]||(e[9]=[x("查询",-1)])]),_:1})]),_:1}),l(U,null,{default:t(()=>[l(u,{type:"success",icon:"CirclePlus",onClick:k},{default:t(()=>[...e[10]||(e[10]=[x("新增",-1)])]),_:1}),l(y,{title:"确定要删除吗？",onConfirm:e[2]||(e[2]=p=>I())},{reference:t(()=>[l(u,{type:"danger",icon:"Remove"},{default:t(()=>[...e[11]||(e[11]=[x("删除",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),main:t(()=>[P((N(),B(D,{ref_key:"tableRef",ref:V,style:{width:"100%"},height:"100%",data:C.value,"highlight-current-row":"",stripe:"","show-overflow-tooltip":""},{default:t(()=>[l(_,{fixed:"left",type:"selection",width:"40"}),l(_,{prop:"postCode",label:"岗位代码","min-width":"120"}),l(_,{prop:"postName",label:"岗位名称","min-width":"120"}),l(_,{prop:"postOrder",label:"岗位排序号","min-width":"100"}),l(_,{prop:"postDesc",label:"岗位描述","min-width":"150"}),l(_,{prop:"action",label:"操作","min-width":100,fixed:"right",align:"center"},{default:t(p=>[l(u,{type:"primary",size:"small",title:"编辑",icon:"Edit",onClick:F=>a(p.row),circle:""},null,8,["onClick"]),l(y,{title:"确定要删除吗？",onConfirm:F=>z(p.row)},{reference:t(()=>[l(u,{type:"danger",size:"small",title:"删除",icon:"Remove",circle:""})]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[q,m.value]])]),footer:t(()=>[l(c,{"current-page":n.params.page,"onUpdate:currentPage":e[3]||(e[3]=p=>n.params.page=p),"page-size":n.params.size,"onUpdate:pageSize":e[4]||(e[4]=p=>n.params.size=p),total:n.params.total,layout:S(R).pageInfo.layout,"page-sizes":S(R).pageInfo.pageSizes,"pager-count":5,onChange:i,background:"",size:"small"},null,8,["current-page","page-size","total","layout","page-sizes"])]),_:1}),l(j,{modelValue:g.value,"onUpdate:modelValue":e[7]||(e[7]=p=>g.value=p),title:"岗位信息",width:"400",onClose:e[8]||(e[8]=p=>b.value?.reset())},{footer:t(()=>[l(u,{onClick:e[5]||(e[5]=()=>g.value=!1)},{default:t(()=>[...e[12]||(e[12]=[x("关闭",-1)])]),_:1}),l(u,{type:"primary",onClick:e[6]||(e[6]=()=>b.value?.save())},{default:t(()=>[...e[13]||(e[13]=[x("保存",-1)])]),_:1})]),default:t(()=>[l(le,{ref_key:"formRef",ref:b,onOnSave:i},null,512)]),_:1},8,["modelValue"])],64)}}};export{se as default};
