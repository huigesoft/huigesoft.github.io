import{I as Q,q as m,J as W,r,n as M,p as P,g as b,o as v,E as w,s as X,f as S,D as Y,c as B,x as l,w as a,z as q,F as T,b as f,t as F,a as I,K as Z}from"./index-CLxOXX9K.js";import{s as ee,g as le,p as te,d as ae,a as oe}from"./HInit-vly2qBM9.js";import{_ as se}from"./UserForm-BdQ_pceg.js";import{l as ne}from"./role-CJhSrFwP.js";import"./utils-B5efKl0g.js";const re={__name:"UserRole",setup(j,{expose:C}){const g=Q("id",null),x=m([]),n=m([]),c=m(!1),k={key:"roleId",label:"roleName"},z=()=>{ne({}).then(i=>{i.success&&(x.value=i.value)})},V=()=>{le({userId:g.value}).then(i=>{i.success&&(n.value=i.value.map(u=>u.roleId))})},s=()=>{const i=n.value.map(u=>({userId:g.value,roleId:u}));c.value=!0,ee(i).then(u=>{c.value=!1,u?.success?w({message:"保存成功！",type:"success"}):w({message:u?.exception||u?.msg||"操作失败！",type:"error"})})},y=()=>{g.value=null,n.value=[]};return W(g,i=>{i!==null&&(z(),V())},{immediate:!0}),C({save:s,reset:y}),(i,u)=>{const R=r("el-transfer"),$=M("loading");return P((v(),b(R,{modelValue:n.value,"onUpdate:modelValue":u[0]||(u[0]=h=>n.value=h),filterable:"",props:k,titles:["未分配","已分配"],"filter-placeholder":"请输入角色名",data:x.value},null,8,["modelValue","data"])),[[$,c.value]])}}},fe={__name:"HUser",setup(j){const C=m(null),g=m(null),x=m(null),n=m(!1),c=m(!1),k=m(!1),z=m([]),V=m(null);Z("id",V);const s=X({loading:!1,open:!1,params:{total:0,page:1,size:S.pageInfo.pageSize,expressions:[{field:"username",query:"like",value:""},{field:"nickname",query:"like",value:""}],sorts:[]}}),y=()=>{n.value=!0,te(s.params).then(o=>{n.value=!1,o.success?(z.value=o.value.records,s.params.total=o.value.total,s.params.page=o.value.current):(z.value=[],w({message:o?.exception||o?.msg||"操作失败！",type:"error"}))})},i=()=>{V.value=null,c.value=!0},u=o=>{V.value=o.userId,c.value=!0},R=o=>{V.value=o.userId,k.value=!0},$=o=>{n.value=!0,ae({id:o.userId}).then(e=>{n.value=!1,e.success?(w({message:"删除成功",type:"success"}),y()):w({message:e?.exception||e?.msg||"操作失败！",type:"error"})})},h=()=>{const o=x.value.getSelectionRows();if(o.length===0)w({type:"error",message:"请选择要删除的内容？"});else{const e=o.map(_=>_.userId);n.value=!0,oe(e).then(_=>{n.value=!1,_.success?(w({message:"删除成功",type:"success"}),y()):w({message:_?.exception||_?.msg||"操作失败！",type:"error"})})}};return Y(()=>{y()}),(o,e)=>{const _=r("el-input"),D=r("el-form-item"),d=r("el-button"),E=r("el-popconfirm"),H=r("el-space"),J=r("el-form"),p=r("el-table-column"),K=r("el-switch"),O=r("el-table"),A=r("el-pagination"),G=r("h-list-layout"),N=r("h-modal"),L=M("loading");return v(),B(T,null,[l(G,null,{header:a(()=>[l(J,{inline:!0},{default:a(()=>[l(D,{label:"用户名"},{default:a(()=>[l(_,{modelValue:s.params.expressions[0].value,"onUpdate:modelValue":e[0]||(e[0]=t=>s.params.expressions[0].value=t),style:{width:"150px"},clearable:""},null,8,["modelValue"])]),_:1}),l(D,{label:"昵称"},{default:a(()=>[l(_,{modelValue:s.params.expressions[1].value,"onUpdate:modelValue":e[1]||(e[1]=t=>s.params.expressions[1].value=t),style:{width:"150px"},clearable:""},null,8,["modelValue"])]),_:1}),l(D,null,{default:a(()=>[l(d,{type:"primary",icon:"Search",round:"",onClick:y},{default:a(()=>[...e[13]||(e[13]=[f("查询",-1)])]),_:1})]),_:1}),l(H,null,{default:a(()=>[o.$has("sys:user:add")?(v(),b(d,{key:0,type:"success",icon:"CirclePlus",onClick:i},{default:a(()=>[...e[14]||(e[14]=[f("新增",-1)])]),_:1})):I("",!0),o.$has("sys:user:add")?(v(),b(E,{key:1,title:"确定要删除吗？",onConfirm:e[2]||(e[2]=t=>h())},{reference:a(()=>[l(d,{type:"danger",icon:"Remove"},{default:a(()=>[...e[15]||(e[15]=[f("删除",-1)])]),_:1})]),_:1})):I("",!0)]),_:1})]),_:1})]),main:a(()=>[P((v(),b(O,{ref_key:"tableRef",ref:x,style:{width:"100%"},height:"100%",data:z.value,"highlight-current-row":"",stripe:"","show-overflow-tooltip":""},{default:a(()=>[l(p,{type:"selection",width:"55",fixed:"left"}),l(p,{prop:"username",label:"用户名","min-width":"120"}),l(p,{prop:"nickname",label:"昵称","min-width":"120"}),l(p,{prop:"realname",label:"真实姓名","min-width":"120"}),l(p,{prop:"gender",label:"性别","min-width":"80"},{default:a(t=>[t.row.gender===1?(v(),B(T,{key:0},[f(" 男 ")],64)):(v(),B(T,{key:1},[f(F(t.row.gender===2?"女":"未知"),1)],64))]),_:1}),l(p,{prop:"phone",label:"电话号码","min-width":"120"}),l(p,{prop:"email",label:"电子邮件","min-width":"200"}),l(p,{prop:"status",label:"状态","min-width":"80"},{default:a(t=>[l(K,{modelValue:t.row.status,"onUpdate:modelValue":U=>t.row.status=U,"inline-prompt":"","active-value":1,"inactive-value":0,"active-text":"启用","inactive-text":"禁用","before-change":()=>!1,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(p,{prop:"expireTime",label:"过期时间","min-width":"180"},{default:a(t=>[f(F(o.$defaultDateTimeFormat(t.row.expireTime)),1)]),_:1}),l(p,{prop:"sessionTime",label:"会话有效期","min-width":"120"}),l(p,{prop:"action",label:"操作","min-width":130,fixed:"right",align:"center"},{default:a(t=>[o.$has("sys:user:update")?(v(),b(d,{key:0,type:"primary",size:"small",title:"编辑",icon:"Edit",onClick:U=>u(t.row),circle:""},null,8,["onClick"])):I("",!0),o.$has("sys:user:role")?(v(),b(d,{key:1,type:"primary",size:"small",title:"用户角色",icon:"User",onClick:U=>R(t.row),circle:""},null,8,["onClick"])):I("",!0),o.$has("sys:user:delete")?(v(),b(E,{key:2,title:"确定要删除吗？",onConfirm:U=>$(t.row)},{reference:a(()=>[l(d,{type:"danger",size:"small",title:"删除",icon:"Remove",circle:""})]),_:1},8,["onConfirm"])):I("",!0)]),_:1})]),_:1},8,["data"])),[[L,n.value]])]),footer:a(()=>[l(A,{"current-page":s.params.page,"onUpdate:currentPage":e[3]||(e[3]=t=>s.params.page=t),"page-size":s.params.size,"onUpdate:pageSize":e[4]||(e[4]=t=>s.params.size=t),total:s.params.total,layout:q(S).pageInfo.layout,"page-sizes":q(S).pageInfo.pageSizes,"pager-count":5,onChange:y,background:"",size:"small"},null,8,["current-page","page-size","total","layout","page-sizes"])]),_:1}),l(N,{modelValue:c.value,"onUpdate:modelValue":e[7]||(e[7]=t=>c.value=t),title:"用户信息",width:"800",onClose:e[8]||(e[8]=t=>C.value?.reset())},{footer:a(()=>[l(d,{onClick:e[5]||(e[5]=()=>c.value=!1)},{default:a(()=>[...e[16]||(e[16]=[f("取消",-1)])]),_:1}),l(d,{type:"primary",onClick:e[6]||(e[6]=()=>C.value?.save())},{default:a(()=>[...e[17]||(e[17]=[f("保存",-1)])]),_:1})]),default:a(()=>[l(se,{ref_key:"formRef",ref:C,onOnSave:y},null,512)]),_:1},8,["modelValue"]),l(N,{modelValue:k.value,"onUpdate:modelValue":e[11]||(e[11]=t=>k.value=t),title:"用户信息",width:"700",onClose:e[12]||(e[12]=t=>g.value?.reset())},{footer:a(()=>[l(d,{onClick:e[9]||(e[9]=()=>k.value=!1)},{default:a(()=>[...e[18]||(e[18]=[f("取消",-1)])]),_:1}),l(d,{type:"primary",onClick:e[10]||(e[10]=()=>g.value?.save())},{default:a(()=>[...e[19]||(e[19]=[f("保存",-1)])]),_:1})]),default:a(()=>[l(re,{ref_key:"roleRef",ref:g},null,512)]),_:1},8,["modelValue"])],64)}}};export{fe as default};
