import{_ as Ce,q as s,v as he,D as Ue,r as o,g as q,o as y,w as t,x as l,b as m,h as x,c as X,F as Ie,G as Te,a as Ee,t as Pe,H as Ke,E as C}from"./index-CLxOXX9K.js";import{m as qe,s as Ne,p as Re,a as Oe,d as Fe,l as $e,g as Be}from"./menu-Dfd8G2qV.js";const Me={class:"dialog-footer"},ze={class:"custom-tree-node"},He={key:0},Se={__name:"HMenu",setup(je){const F=s(!0),Y={parentId:[{required:!0,message:"父级菜单不能为空！",trigger:"change"}],menuTitle:[{required:!0,message:"菜单标题不能为空！",trigger:"blur"}],menuPath:[{required:!0,message:"菜单地址不能为空！",trigger:"blur"}],menuTarget:[{required:!0,message:"打开目标不能为空！",trigger:"blur"}],menuType:[{required:!0,message:"菜单类型不能为空！",trigger:"change"}],menuIcon:[{required:!0,message:"菜单图标不能为空！",trigger:"change"}],menuOrder:[{required:!0,message:"菜单排序号不能为空！",trigger:"blur"}]},h={"permis.*.permiName":[{required:!0,message:"请输入权限名称",trigger:"blur"}],"permis.*.permiKey":[{required:!0,message:"请输入权限标识",trigger:"blur"},{validator:(a,e,r)=>{const d=parseInt(a.field?.split(".")[1]);for(let g=0;g<f.value.permis.length;g++)if(g!==d&&f.value.permis[g].permiKey===e)return r("权限标识重复");return r()},trigger:"blur"},{validator:async(a,e)=>{const r=parseInt(a.field?.split(".")[1]),d={permiKey:e,idValue:f.value.permis[r].permiId,id:"permiId"};await Re(d).then(g=>g.value?Promise.reject("权限标识已存在！"):Promise.resolve())},trigger:"blur"}]},U=s(!1),V=s(!1),$=s(null),B=s(null),k=s(null),M=s(null),z=s(null),H=s([]),I=s(null),_=s(null),w=s(["root"]),N=s(0),u=s({}),f=s({permis:[{permiEnable:1}]}),Z={value:"key",label:"title",children:"children"},R=s(300),S=he(()=>[{key:"root",title:"菜单管理",label:"菜单管理",value:"root",children:H.value}]),T=()=>{qe({}).then(a=>{a.success&&(H.value=a.value)})},ee=a=>{$.value?.filter(a)},le=(a,e)=>e.title?.includes(a),te=()=>{Ke(B.value.$el,a=>{const e=a[0],{height:r}=e.contentRect;r-50<200&&(R.value=200),R.value=r-50})},ae=a=>{a.key!=="root"&&(_.value=a.key,re(a.key))},ne=a=>{w.value.findIndex(r=>r===a.key)===-1&&w.value.push(a.key)},ue=a=>{const e=w.value.findIndex(r=>r===a.key);e>-1&&w.value.splice(e,1)},oe=a=>{_.value=a.key},re=a=>{U.value=!0,Be({id:a}).then(e=>{U.value=!1,e.success&&(u.value=e.value,k.value.resetFields())}),j(a)},j=a=>{$e({expressions:[{field:"menuId",query:"eq",value:a}]}).then(e=>{e.success&&(f.value.permis=e.value)})},se=()=>{k.value.validate().then(()=>{U.value=!0,Ne(u.value).then(a=>{U.value=!1,a.success&&(C.success({message:"保存成功"}),T())})})},de=()=>{k.value.resetFields(),_.value=null},ie=a=>{k.value.resetFields(),u.value={parentId:a.key,menuEnable:1,menuTarget:0,menuType:0,menuOrder:100},_.value=null,N.value=0},me=a=>{V.value=!0,I.value=a},pe=()=>{V.value=!1,I.value!==null&&(I.value?.children?.length>0?C.error({message:"包含子菜单，无法删除！"}):Fe({id:I.value.key}).then(a=>{a.success?(T(),C.success({message:"删除成功！"})):C.error({message:"删除失败！"+a.exception})}))},D=a=>{a===null?f.value.permis.push({permiEnable:1}):f.value.permis.splice(a+1,0,{permiEnable:1})},fe=a=>{f.value.permis.splice(a,1)},ve=()=>{M.value.validate().then(()=>{const a=f.value.permis;for(let e=0;e<a.length;e++)a[e].menuId=_.value;Oe(a,u.value.menuId).then(e=>{e.success&&(f.value.permis=e.value,C.success("保存成功"))})})},ce=()=>{j(_.value)};return Ue(()=>{T(),te()}),(a,e)=>{const r=o("el-input"),d=o("el-button"),g=o("el-dialog"),G=o("h-icon"),O=o("el-dropdown-item"),_e=o("el-dropdown-menu"),ge=o("el-dropdown"),be=o("el-tree-v2"),L=o("el-card"),ye=o("el-tree-select"),i=o("el-form-item"),p=o("h-col"),E=o("el-option"),W=o("el-select"),Ve=o("h-icon-picker"),ke=o("el-input-number"),A=o("el-switch"),P=o("el-space"),K=o("el-row"),J=o("el-form"),Q=o("el-tab-pane"),b=o("el-col"),we=o("el-tabs"),xe=o("h-split-h");return y(),q(xe,{handlerShow:F.value,"onUpdate:handlerShow":e[17]||(e[17]=n=>F.value=n),leftWidth:260},{left:t(()=>[l(L,{ref_key:"leftCard",ref:B,class:"card not-select",shadow:"never","body-style":{height:"calc(100% - 40px)"}},{header:t(()=>[l(r,{size:"small","prefix-icon":"Search",modelValue:z.value,"onUpdate:modelValue":e[0]||(e[0]=n=>z.value=n),clearable:"",placeholder:"请输入内容",onInput:ee},null,8,["modelValue"])]),default:t(()=>[l(g,{modelValue:V.value,"onUpdate:modelValue":e[2]||(e[2]=n=>V.value=n),width:"300"},{footer:t(()=>[x("div",Me,[l(d,{onClick:e[1]||(e[1]=n=>V.value=!1)},{default:t(()=>[...e[18]||(e[18]=[m("取消",-1)])]),_:1}),l(d,{type:"primary",onClick:pe},{default:t(()=>[...e[19]||(e[19]=[m(" 确认 ",-1)])]),_:1})])]),default:t(()=>[e[20]||(e[20]=x("span",null,"确定要删除吗？",-1))]),_:1},8,["modelValue"]),l(be,{ref_key:"treeRef",ref:$,props:Z,data:S.value,"filter-method":le,"expand-on-click-node":!1,"highlight-current":"","default-expanded-keys":w.value,height:R.value,onCurrentChange:oe,onNodeClick:ae,onNodeExpand:ne,onNodeCollapse:ue},{default:t(({node:n,data:v})=>[x("span",ze,[x("span",null,[l(G,{type:v.iconStr},null,8,["type"]),m(" "+Pe(n.label),1)]),_.value===v.key?(y(),X("span",He,[l(ge,{placement:"bottom-start"},{dropdown:t(()=>[l(_e,null,{default:t(()=>[l(O,{icon:"CirclePlus",onClick:c=>ie(v)},{default:t(()=>[...e[21]||(e[21]=[m("新增",-1)])]),_:1},8,["onClick"]),l(O,{icon:"Remove",onClick:c=>me(v)},{default:t(()=>[...e[22]||(e[22]=[m(" 删除 ",-1)])]),_:1},8,["onClick"]),l(O,{icon:"Refresh",onClick:e[3]||(e[3]=c=>T())},{default:t(()=>[...e[23]||(e[23]=[m(" 刷新 ",-1)])]),_:1})]),_:2},1024)]),default:t(()=>[l(d,{size:"small",link:"",icon:"MoreFilled"})]),_:2},1024)])):Ee("",!0)])]),_:1},8,["data","default-expanded-keys","height"])]),_:1},512)]),right:t(()=>[l(L,{shadow:"never",class:"card not-select","body-style":{height:"calc(100% - 35px)",overflow:"auto"}},{default:t(()=>[l(we,{modelValue:N.value,"onUpdate:modelValue":e[16]||(e[16]=n=>N.value=n)},{default:t(()=>[l(Q,{label:"基本信息",name:0},{default:t(()=>[l(J,{ref_key:"formRef",ref:k,model:u.value,"label-width":"120px",rules:Y,"label-suffix":"："},{default:t(()=>[l(K,{gutter:10},{default:t(()=>[l(p,null,{default:t(()=>[l(i,{label:"上级菜单",prop:"parentId"},{default:t(()=>[l(ye,{modelValue:u.value.parentId,"onUpdate:modelValue":e[4]||(e[4]=n=>u.value.parentId=n),"check-strictly":"",data:S.value},null,8,["modelValue","data"])]),_:1})]),_:1}),l(p,null,{default:t(()=>[l(i,{label:"菜单标题",prop:"menuTitle"},{default:t(()=>[l(r,{modelValue:u.value.menuTitle,"onUpdate:modelValue":e[5]||(e[5]=n=>u.value.menuTitle=n),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(p,null,{default:t(()=>[l(i,{label:"菜单地址",prop:"menuPath"},{default:t(()=>[l(r,{modelValue:u.value.menuPath,"onUpdate:modelValue":e[6]||(e[6]=n=>u.value.menuPath=n),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(p,null,{default:t(()=>[l(i,{label:"打开目标",prop:"menuTarget"},{default:t(()=>[l(W,{modelValue:u.value.menuTarget,"onUpdate:modelValue":e[7]||(e[7]=n=>u.value.menuTarget=n),clearable:""},{default:t(()=>[l(E,{label:"嵌入",value:0}),l(E,{label:"新窗口",value:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(p,null,{default:t(()=>[l(i,{label:"菜单类型",prop:"menuType"},{default:t(()=>[l(W,{modelValue:u.value.menuType,"onUpdate:modelValue":e[8]||(e[8]=n=>u.value.menuType=n),clearable:""},{default:t(()=>[l(E,{label:"内部路由",value:0}),l(E,{label:"外部链接",value:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),u.value.menuType===1?(y(),q(p,{key:0},{default:t(()=>[l(i,{label:"链接地址",prop:"menuUrl"},{default:t(()=>[l(r,{modelValue:u.value.menuUrl,"onUpdate:modelValue":e[9]||(e[9]=n=>u.value.menuUrl=n),clearable:""},null,8,["modelValue"])]),_:1})]),_:1})):(y(),q(p,{key:1},{default:t(()=>[l(i,{label:"路由标识",prop:"resourceKey"},{default:t(()=>[l(r,{modelValue:u.value.resourceKey,"onUpdate:modelValue":e[10]||(e[10]=n=>u.value.resourceKey=n),clearable:""},null,8,["modelValue"])]),_:1})]),_:1})),l(p,null,{default:t(()=>[l(i,{label:"菜单图标",prop:"menuIcon"},{default:t(()=>[l(Ve,{modelValue:u.value.menuIcon,"onUpdate:modelValue":e[11]||(e[11]=n=>u.value.menuIcon=n)},null,8,["modelValue"])]),_:1})]),_:1}),l(p,null,{default:t(()=>[l(i,{label:"排序号",prop:"menuOrder"},{default:t(()=>[l(ke,{style:{width:"100%"},modelValue:u.value.menuOrder,"onUpdate:modelValue":e[12]||(e[12]=n=>u.value.menuOrder=n)},null,8,["modelValue"])]),_:1})]),_:1}),l(p,null,{default:t(()=>[l(i,{label:"菜单参数",prop:"menuParams"},{default:t(()=>[l(r,{rows:3,type:"textarea",modelValue:u.value.menuParams,"onUpdate:modelValue":e[13]||(e[13]=n=>u.value.menuParams=n)},null,8,["modelValue"])]),_:1})]),_:1}),l(p,null,{default:t(()=>[l(i,{label:"是否启用",prop:"menuEnable"},{default:t(()=>[l(A,{"active-value":1,"inactive-value":0,modelValue:u.value.menuEnable,"onUpdate:modelValue":e[14]||(e[14]=n=>u.value.menuEnable=n)},null,8,["modelValue"])]),_:1})]),_:1}),l(p,{style:{"text-align":"right"}},{default:t(()=>[l(P,null,{default:t(()=>[l(d,{onClick:de},{default:t(()=>[...e[24]||(e[24]=[m("重置",-1)])]),_:1}),l(d,{type:"primary",onClick:se},{default:t(()=>[...e[25]||(e[25]=[m("保存",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(Q,{label:"权限标识",disabled:_.value===null,name:1},{default:t(()=>[l(J,{ref_key:"permiFormRef",ref:M,model:f.value,"label-width":"0px",rules:h,"label-suffix":"："},{default:t(()=>[l(K,{gutter:32},{default:t(()=>[l(b,{span:6},{default:t(()=>[...e[26]||(e[26]=[m("权限名称",-1)])]),_:1}),l(b,{span:11},{default:t(()=>[...e[27]||(e[27]=[m("权限标识(多个以半角逗号分隔)",-1)])]),_:1}),l(b,{span:3},{default:t(()=>[...e[28]||(e[28]=[m("状态",-1)])]),_:1}),l(b,{span:4},{default:t(()=>[l(P,{wrap:""},{default:t(()=>[e[29]||(e[29]=m(" 操作 ",-1)),l(d,{icon:"Plus",size:"small",onClick:e[15]||(e[15]=n=>D(a.index)),type:"primary",plain:""})]),_:1})]),_:1})]),_:1}),e[32]||(e[32]=x("br",null,null,-1)),(y(!0),X(Ie,null,Te(f.value.permis,(n,v)=>(y(),q(K,{key:v,gutter:32},{default:t(()=>[l(b,{span:6},{default:t(()=>[l(i,{"inline-message":"","label-width":"0px",prop:"permis."+v+".permiName",rules:h["permis.*.permiName"]},{default:t(()=>[l(r,{modelValue:n.permiName,"onUpdate:modelValue":c=>n.permiName=c},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])]),_:2},1024),l(b,{span:11},{default:t(()=>[l(i,{"inline-message":"","label-width":"0px",prop:"permis."+v+".permiKey",rules:h["permis.*.permiKey"]},{default:t(()=>[l(r,{modelValue:n.permiKey,"onUpdate:modelValue":c=>n.permiKey=c},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])]),_:2},1024),l(b,{span:3},{default:t(()=>[l(i,{"inline-message":"","label-width":"0px",prop:"permis."+v+".permiEnable",rules:h["permis.*.permiEnable"]},{default:t(()=>[l(A,{modelValue:n.permiEnable,"onUpdate:modelValue":c=>n.permiEnable=c,"inline-prompt":"","active-value":1,"inactive-value":0,"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])]),_:2},1024),l(b,{span:4},{default:t(()=>[l(P,{wrap:""},{default:t(()=>[l(d,{icon:"Plus",size:"small",onClick:c=>D(v),type:"primary",plain:""},null,8,["onClick"]),l(d,{icon:"Minus",size:"small",onClick:c=>fe(v),type:"danger",plain:""},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),l(K,null,{default:t(()=>[l(p,{style:{"text-align":"right"}},{default:t(()=>[l(P,null,{default:t(()=>[l(d,{onClick:ce},{default:t(()=>[...e[30]||(e[30]=[m("重置",-1)])]),_:1}),l(d,{type:"primary",onClick:ve},{default:t(()=>[...e[31]||(e[31]=[m("保存",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["handlerShow"])}}},We=Ce(Se,[["__scopeId","data-v-dcb1ab7a"]]);export{We as default};
