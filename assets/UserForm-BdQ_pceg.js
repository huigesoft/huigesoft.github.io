import{u as N}from"./utils-B5efKl0g.js";import{c as F,b as J,e as L}from"./HInit-vly2qBM9.js";import{I as M,q as f,J as g,r,n as O,p as G,g as x,o as U,w as t,x as e,a as H,z as w,E as c}from"./index-CLxOXX9K.js";const Z={__name:"UserForm",emits:["onSave"],setup(K,{expose:y,emit:k}){const I=k,{hasText:i,validatePhone:T,validatEmail:S}=N(),h={username:[{validator:async(s,a)=>{if(!i(a))return Promise.reject("请输入用户名");const d={username:a,idValue:l.value.userId,id:"userId"};await L(d).then(n=>n.value?Promise.reject("用户名已存在！"):Promise.resolve())},trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],nickname:[{required:!0,message:"请输入用户昵称",trigger:"blur"}],phone:[{validator:T,trigger:"blur"}],email:[{validator:S,trigger:"blur"}]},p=M("id",null),v=f(!1),_=f(null),l=f({}),E=()=>{J({id:p.value}).then(s=>{s.success?l.value=s.value:(l.value={},c({message:s?.exception||s?.msg||"操作失败！",type:"error"}))})},j=()=>{_.value.validate().then(()=>{v.value=!0,F(l.value).then(s=>{v.value=!1,s?.success?(l.value=s.value,c({message:"保存成功！",type:"success"}),I("onSave")):c({message:s?.exception||s?.msg||"操作失败！",type:"error"})})})},C=()=>{p.value=null,l.value={status:1,sessionTime:12,expireTime:4102415999e3,admined:0,maxSession:10}};g(p,s=>{s!=null&&E()},{immediate:!0}),g(()=>l.value.avatar,s=>{s!==null?P(s,32,a=>{l.value.smallAvatar=a}):l.value.smallAvatar=null});const P=(s,a,d)=>{const n=new Image;n.src=s,n.onload=function(){const o=document.createElement("canvas");o.width=a,o.height=a;const m=o.getContext("2d");m.clearRect(0,0,o.width,o.height),m.drawImage(n,0,0,a,o.height),d(o.toDataURL("image/png"))}};return y({save:j,reset:C}),(s,a)=>{const d=r("el-input"),n=r("el-form-item"),o=r("h-col"),m=r("el-option"),R=r("el-select"),q=r("h-base64-img"),V=r("el-input-number"),z=r("h-date-picker"),b=r("el-switch"),B=r("el-row"),D=r("el-form"),A=O("loading");return G((U(),x(D,{ref_key:"formRef",ref:_,model:l.value,"label-width":"120px",rules:h,"label-suffix":"："},{default:t(()=>[e(B,{gutter:10},{default:t(()=>[e(o,null,{default:t(()=>[e(n,{label:"用户账号",prop:"username"},{default:t(()=>[e(d,{modelValue:l.value.username,"onUpdate:modelValue":a[0]||(a[0]=u=>l.value.username=u),readonly:w(i)(l.value?.userId),clearable:""},null,8,["modelValue","readonly"])]),_:1})]),_:1}),w(i)(l.value?.userId)?H("",!0):(U(),x(o,{key:0},{default:t(()=>[e(n,{label:"密码",prop:"password"},{default:t(()=>[e(d,{modelValue:l.value.password,"onUpdate:modelValue":a[1]||(a[1]=u=>l.value.password=u),clearable:""},null,8,["modelValue"])]),_:1})]),_:1})),e(o,null,{default:t(()=>[e(n,{label:"昵称",prop:"nickname"},{default:t(()=>[e(d,{modelValue:l.value.nickname,"onUpdate:modelValue":a[2]||(a[2]=u=>l.value.nickname=u),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(o,null,{default:t(()=>[e(n,{label:"真实姓名",prop:"realname"},{default:t(()=>[e(d,{modelValue:l.value.realname,"onUpdate:modelValue":a[3]||(a[3]=u=>l.value.realname=u),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(o,null,{default:t(()=>[e(n,{label:"性别",prop:"gender"},{default:t(()=>[e(R,{modelValue:l.value.gender,"onUpdate:modelValue":a[4]||(a[4]=u=>l.value.gender=u),clearable:""},{default:t(()=>[e(m,{label:"男",value:1}),e(m,{label:"女",value:2}),e(m,{label:"未知",value:3})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(o,null,{default:t(()=>[e(n,{label:"电话号码",prop:"phone"},{default:t(()=>[e(d,{modelValue:l.value.phone,"onUpdate:modelValue":a[5]||(a[5]=u=>l.value.phone=u),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(o,null,{default:t(()=>[e(n,{label:"电子邮件",prop:"email"},{default:t(()=>[e(d,{modelValue:l.value.email,"onUpdate:modelValue":a[6]||(a[6]=u=>l.value.email=u),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(o,{xs:24,sm:24},{default:t(()=>[e(n,{label:"联系地址",prop:"address"},{default:t(()=>[e(d,{modelValue:l.value.address,"onUpdate:modelValue":a[7]||(a[7]=u=>l.value.address=u),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(o,{xs:24,sm:24},{default:t(()=>[e(n,{label:"个人简介",prop:"introduction"},{default:t(()=>[e(d,{modelValue:l.value.introduction,"onUpdate:modelValue":a[8]||(a[8]=u=>l.value.introduction=u),rows:2,type:"textarea",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(o,null,{default:t(()=>[e(n,{label:"头像",prop:"avatar"},{default:t(()=>[e(q,{modelValue:l.value.avatar,"onUpdate:modelValue":a[9]||(a[9]=u=>l.value.avatar=u),size:"200px"},null,8,["modelValue"])]),_:1})]),_:1}),e(o,null,{default:t(()=>[e(o,{xs:24,sm:24},{default:t(()=>[e(n,{label:"会话有效期(时)",prop:"sessionTime"},{default:t(()=>[e(V,{modelValue:l.value.sessionTime,"onUpdate:modelValue":a[10]||(a[10]=u=>l.value.sessionTime=u),style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(o,{xs:24,sm:24},{default:t(()=>[e(n,{label:"最大会话数",prop:"maxSession"},{default:t(()=>[e(V,{modelValue:l.value.maxSession,"onUpdate:modelValue":a[11]||(a[11]=u=>l.value.maxSession=u),style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(o,{xs:24,sm:24},{default:t(()=>[e(n,{label:"用户过期时间",prop:"expireTime"},{default:t(()=>[e(z,{modelValue:l.value.expireTime,"onUpdate:modelValue":a[12]||(a[12]=u=>l.value.expireTime=u),type:"date",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(o,{xs:12,sm:12},{default:t(()=>[e(n,{label:"管理员",prop:"admined"},{default:t(()=>[e(b,{modelValue:l.value.admined,"onUpdate:modelValue":a[13]||(a[13]=u=>l.value.admined=u),"inline-prompt":"","active-value":1,"inactive-value":0,"active-text":"是","inactive-text":"否"},null,8,["modelValue"])]),_:1})]),_:1}),e(o,{xs:12,sm:12},{default:t(()=>[e(n,{label:"状态",prop:"status"},{default:t(()=>[e(b,{modelValue:l.value.status,"onUpdate:modelValue":a[14]||(a[14]=u=>l.value.status=u),"inline-prompt":"","active-value":1,"inactive-value":0,"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])),[[A,v.value]])}}};export{Z as _};
