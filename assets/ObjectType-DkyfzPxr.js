import{I as O,q as f,J as M,r,n as N,p as $,g as j,o as R,w as t,x as l,E as v,s as J,f as U,D as K,c as G,z as S,b as y,t as B,F as H,K as L}from"./index-CLxOXX9K.js";import{s as Q,g as W,c as X,p as Y,d as Z,a as ee}from"./object-type-otSOTyCC.js";import{u as le}from"./utils-B5efKl0g.js";const te={__name:"ObjectTypeForm",emits:["onSave"],setup(T,{expose:w,emit:C}){const d=C,{hasText:g}=le(),x={typeCode:[{validator:async(e,o)=>{if(!g(o))return Promise.reject("请输入类型代码");const c={typeCode:o,idValue:u.value.typeId,id:"typeId"};await X(c).then(i=>i.value?Promise.reject("类型代码已存在！"):Promise.resolve())},trigger:"blur"}],typeName:[{required:!0,message:"请输入类型名称",trigger:"blur"}]},n=O("id",null),m=f(!1),k=f(null),u=f({}),z=()=>{W({id:n.value}).then(e=>{e.success?u.value=e.value:(u.value={},v({message:e?.exception||e?.msg||"操作失败！",type:"error"}))})},h=()=>{k.value.validate().then(()=>{m.value=!0,Q(u.value).then(e=>{m.value=!1,e?.success?(u.value=e.value,v({message:"保存成功！",type:"success"}),d("onSave")):v({message:e?.exception||e?.msg||"操作失败！",type:"error"})})})},a=()=>{n.value=null,u.value={}};return M(n,e=>{e!==null&&z()},{immediate:!0}),w({save:h,reset:a}),(e,o)=>{const c=r("el-input"),i=r("el-form-item"),b=r("h-col"),D=r("el-row"),I=r("el-form"),p=N("loading");return $((R(),j(I,{ref_key:"formRef",ref:k,model:u.value,"label-width":"120px",rules:x,"label-suffix":"："},{default:t(()=>[l(D,{gutter:10},{default:t(()=>[l(b,{sm:24},{default:t(()=>[l(i,{label:"类型代码",prop:"typeCode"},{default:t(()=>[l(c,{modelValue:u.value.typeCode,"onUpdate:modelValue":o[0]||(o[0]=_=>u.value.typeCode=_),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(b,{sm:24},{default:t(()=>[l(i,{label:"类型名称",prop:"typeName"},{default:t(()=>[l(c,{modelValue:u.value.typeName,"onUpdate:modelValue":o[1]||(o[1]=_=>u.value.typeName=_),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(b,{sm:24},{default:t(()=>[l(i,{label:"类型描述",prop:"typeDesc"},{default:t(()=>[l(c,{modelValue:u.value.typeDesc,"onUpdate:modelValue":o[2]||(o[2]=_=>u.value.typeDesc=_),type:"textarea",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])),[[p,m.value]])}}},ne={__name:"ObjectType",setup(T){const w=f(null),C=f(null),d=f(!1),g=f(!1),V=f([]),x=f(null);L("id",x);const n=J({loading:!1,open:!1,params:{total:0,page:1,size:U.pageInfo.pageSize,expressions:[{field:"typeCode",query:"like",value:""},{field:"typeName",query:"like",value:""}]}}),m=()=>{d.value=!0,Y(n.params).then(a=>{d.value=!1,a.success?(V.value=a.value.records,n.params.total=a.value.total,n.params.page=a.value.current):(V.value=[],v({message:a?.exception||a?.msg||"操作失败！",type:"error"}))})},k=()=>{x.value=null,g.value=!0},u=a=>{x.value=a.typeId,g.value=!0},z=a=>{d.value=!0,Z({id:a.typeId}).then(e=>{d.value=!1,e.success?(v({message:"删除成功",type:"success"}),m()):v({message:e?.exception||e?.msg||"操作失败！",type:"error"})})},h=()=>{const a=C.value.getSelectionRows();if(a.length===0)v({type:"error",message:"请选择要删除的内容？"});else{const e=a.map(o=>o.typeId);d.value=!0,ee(e).then(o=>{d.value=!1,o.success?(v({message:"删除成功",type:"success"}),m()):v({message:o?.exception||o?.msg||"操作失败！",type:"error"})})}};return K(()=>{m()}),(a,e)=>{const o=r("el-input"),c=r("el-form-item"),i=r("el-button"),b=r("el-popconfirm"),D=r("el-space"),I=r("el-form"),p=r("el-table-column"),_=r("el-table"),E=r("el-pagination"),F=r("h-list-layout"),P=r("h-modal"),q=N("loading");return R(),G(H,null,[l(F,null,{header:t(()=>[l(I,{inline:!0},{default:t(()=>[l(c,{label:"岗位代码"},{default:t(()=>[l(o,{modelValue:n.params.expressions[0].value,"onUpdate:modelValue":e[0]||(e[0]=s=>n.params.expressions[0].value=s),style:{width:"150px"},clearable:""},null,8,["modelValue"])]),_:1}),l(c,{label:"岗位名称"},{default:t(()=>[l(o,{modelValue:n.params.expressions[1].value,"onUpdate:modelValue":e[1]||(e[1]=s=>n.params.expressions[1].value=s),style:{width:"150px"},clearable:""},null,8,["modelValue"])]),_:1}),l(c,null,{default:t(()=>[l(i,{type:"primary",icon:"Search",round:"",onClick:m},{default:t(()=>[...e[9]||(e[9]=[y("查询",-1)])]),_:1})]),_:1}),l(D,null,{default:t(()=>[l(i,{type:"success",icon:"CirclePlus",onClick:k},{default:t(()=>[...e[10]||(e[10]=[y("新增",-1)])]),_:1}),l(b,{title:"确定要删除吗？",onConfirm:e[2]||(e[2]=s=>h())},{reference:t(()=>[l(i,{type:"danger",icon:"Remove"},{default:t(()=>[...e[11]||(e[11]=[y("删除",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),main:t(()=>[$((R(),j(_,{ref_key:"tableRef",ref:C,style:{width:"100%"},height:"100%",data:V.value,"highlight-current-row":"",stripe:"","show-overflow-tooltip":""},{default:t(()=>[l(p,{fixed:"left",type:"selection",width:"40"}),l(p,{prop:"typeCode",label:"类型代码","min-width":"120"}),l(p,{prop:"typeName",label:"类型名称","min-width":"120"}),l(p,{prop:"typeDesc",label:"类型描述","min-width":"150"}),l(p,{prop:"createBy",label:"创建人","min-width":"100"}),l(p,{prop:"createAt",label:"创建时间","min-width":"180"},{default:t(s=>[y(B(a.$defaultDateTimeFormat(s.row.createAt)),1)]),_:1}),l(p,{prop:"updateBy",label:"最后修改人","min-width":"100"}),l(p,{prop:"updateAt",label:"最后修改时间","min-width":"180"},{default:t(s=>[y(B(a.$defaultDateTimeFormat(s.row.updateAt)),1)]),_:1}),l(p,{prop:"action",label:"操作","min-width":100,fixed:"right",align:"center"},{default:t(s=>[l(i,{type:"primary",size:"small",title:"编辑",icon:"Edit",onClick:A=>u(s.row),circle:""},null,8,["onClick"]),l(b,{title:"确定要删除吗？",onConfirm:A=>z(s.row)},{reference:t(()=>[l(i,{type:"danger",size:"small",title:"删除",icon:"Remove",circle:""})]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[q,d.value]])]),footer:t(()=>[l(E,{"current-page":n.params.page,"onUpdate:currentPage":e[3]||(e[3]=s=>n.params.page=s),"page-size":n.params.size,"onUpdate:pageSize":e[4]||(e[4]=s=>n.params.size=s),total:n.params.total,layout:S(U).pageInfo.layout,"page-sizes":S(U).pageInfo.pageSizes,"pager-count":5,onChange:m,background:"",size:"small"},null,8,["current-page","page-size","total","layout","page-sizes"])]),_:1}),l(P,{modelValue:g.value,"onUpdate:modelValue":e[7]||(e[7]=s=>g.value=s),title:"岗位信息",width:"400",onClose:e[8]||(e[8]=s=>w.value?.reset())},{footer:t(()=>[l(i,{onClick:e[5]||(e[5]=()=>g.value=!1)},{default:t(()=>[...e[12]||(e[12]=[y("关闭",-1)])]),_:1}),l(i,{type:"primary",onClick:e[6]||(e[6]=()=>w.value?.save())},{default:t(()=>[...e[13]||(e[13]=[y("保存",-1)])]),_:1})]),default:t(()=>[l(te,{ref_key:"formRef",ref:w,onOnSave:m},null,512)]),_:1},8,["modelValue"])],64)}}};export{ne as default};
