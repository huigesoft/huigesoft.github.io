import{u as A,q as v,D as O,r as n,n as G,p as H,g as k,o as C,w as l,x as e,a as J,b as i,t as q,z as K,E as f}from"./index-CLxOXX9K.js";import{u as L}from"./utils-B5efKl0g.js";import{b as Q,c as W,u as X}from"./HInit-vly2qBM9.js";const le={__name:"UserCenter",setup(Y){const{hasText:V,validatePhone:R,validatEmail:j}=L(),b=A(),D={nickname:[{required:!0,message:"请输入用户昵称",trigger:"blur"}],phone:[{validator:R,trigger:"blur"}],email:[{validator:j,trigger:"blur"}]},I={oldPassword:[{required:!0,message:"请输入旧密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"}],confirmPassword:[{validator:async(s,a)=>V(a)?d.value.newPassword!==d.value.confirmPassword?Promise.reject("新密码和确认密码不一致！"):Promise.resolve():Promise.reject("请输入确认密码"),trigger:"blur"}]},g=v(null),c=v(null),p=v(!1),o=v({}),d=v({username:b.user?.username}),B=()=>{g.value.validate().then(()=>{p.value=!0,W(o.value).then(s=>{p.value=!1,s?.success?(o.value=s.value,b.setUser(o.value),f({message:"保存成功！",type:"success"})):f({message:s?.exception||s?.msg||"操作失败！",type:"error"})})})},E=()=>{c.value.resetFields()},F=()=>{c.value.validate().then(()=>{p.value=!0,X(d.value).then(s=>{if(p.value=!1,s.success){const a=s.value;a===3?f({message:"密码修改成功！",type:"success"}):a===1?f({message:"密码修改失败，旧密码不正确！",type:"error"}):f({message:"密码修改失败，请稍后重试！",type:"error"})}else f({message:s?.exception||s?.msg||"操作失败！",type:"error"})})})},y=()=>{const s=b.user?.userId;s!==void 0&&(p.value=!0,Q({id:s}).then(a=>{p.value=!1,a.success&&(o.value=a.value)}))};return O(()=>{y()}),(s,a)=>{const r=n("el-form-item"),t=n("h-col"),m=n("el-input"),w=n("el-option"),N=n("el-select"),S=n("h-base64-img"),_=n("el-button"),P=n("el-row"),U=n("el-form"),x=n("el-tab-pane"),z=n("el-space"),M=n("el-tabs"),T=G("loading");return H((C(),k(M,{type:"border-card",style:{height:"100%"}},{default:l(()=>[e(x,{label:"个人信息"},{default:l(()=>[e(U,{ref_key:"formRef",ref:g,model:o.value,"label-width":"120px",rules:D,"label-suffix":"："},{default:l(()=>[e(P,{gutter:10},{default:l(()=>[e(t,null,{default:l(()=>[e(r,{label:"用户账号",prop:"username"},{default:l(()=>[i(q(o.value.username),1)]),_:1})]),_:1}),K(V)(o.value?.userId)?J("",!0):(C(),k(t,{key:0},{default:l(()=>[e(r,{label:"密码",prop:"password"},{default:l(()=>[e(m,{modelValue:o.value.password,"onUpdate:modelValue":a[0]||(a[0]=u=>o.value.password=u),clearable:""},null,8,["modelValue"])]),_:1})]),_:1})),e(t,null,{default:l(()=>[e(r,{label:"昵称",prop:"nickname"},{default:l(()=>[e(m,{modelValue:o.value.nickname,"onUpdate:modelValue":a[1]||(a[1]=u=>o.value.nickname=u),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(t,null,{default:l(()=>[e(r,{label:"真实姓名",prop:"realname"},{default:l(()=>[e(m,{modelValue:o.value.realname,"onUpdate:modelValue":a[2]||(a[2]=u=>o.value.realname=u),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(t,null,{default:l(()=>[e(r,{label:"性别",prop:"gender"},{default:l(()=>[e(N,{modelValue:o.value.gender,"onUpdate:modelValue":a[3]||(a[3]=u=>o.value.gender=u),clearable:""},{default:l(()=>[e(w,{label:"男",value:1}),e(w,{label:"女",value:2}),e(w,{label:"未知",value:3})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(t,null,{default:l(()=>[e(r,{label:"电话号码",prop:"phone"},{default:l(()=>[e(m,{modelValue:o.value.phone,"onUpdate:modelValue":a[4]||(a[4]=u=>o.value.phone=u),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(t,null,{default:l(()=>[e(r,{label:"电子邮件",prop:"email"},{default:l(()=>[e(m,{modelValue:o.value.email,"onUpdate:modelValue":a[5]||(a[5]=u=>o.value.email=u),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(t,{xs:24,sm:24},{default:l(()=>[e(r,{label:"联系地址",prop:"address"},{default:l(()=>[e(m,{modelValue:o.value.address,"onUpdate:modelValue":a[6]||(a[6]=u=>o.value.address=u),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(t,{xs:24,sm:24},{default:l(()=>[e(r,{label:"个人简介",prop:"introduction"},{default:l(()=>[e(m,{modelValue:o.value.introduction,"onUpdate:modelValue":a[7]||(a[7]=u=>o.value.introduction=u),rows:2,type:"textarea",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(t,null,{default:l(()=>[e(r,{label:"头像",prop:"avatar"},{default:l(()=>[e(S,{modelValue:o.value.avatar,"onUpdate:modelValue":a[8]||(a[8]=u=>o.value.avatar=u),size:"150px"},null,8,["modelValue"])]),_:1})]),_:1}),e(t),e(t),e(t,null,{default:l(()=>[e(_,{onClick:y},{default:l(()=>[...a[12]||(a[12]=[i("重置",-1)])]),_:1}),e(_,{type:"primary",onClick:B},{default:l(()=>[...a[13]||(a[13]=[i("保存",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(x,{label:"密码修改"},{default:l(()=>[e(U,{ref_key:"passFormRef",ref:c,model:d.value,"label-width":"120px",rules:I,"label-suffix":"："},{default:l(()=>[e(P,null,{default:l(()=>[e(t,null,{default:l(()=>[e(r,{label:"用户名",prop:"username"},{default:l(()=>[i(q(d.value.username),1)]),_:1})]),_:1}),e(t),e(t,null,{default:l(()=>[e(r,{label:"旧密码",prop:"oldPassword"},{default:l(()=>[e(m,{modelValue:d.value.oldPassword,"onUpdate:modelValue":a[9]||(a[9]=u=>d.value.oldPassword=u),type:"password","show-password":""},null,8,["modelValue"])]),_:1})]),_:1}),e(t),e(t,null,{default:l(()=>[e(r,{label:"新密码",prop:"newPassword"},{default:l(()=>[e(m,{modelValue:d.value.newPassword,"onUpdate:modelValue":a[10]||(a[10]=u=>d.value.newPassword=u),type:"password","show-password":""},null,8,["modelValue"])]),_:1})]),_:1}),e(t),e(t,null,{default:l(()=>[e(r,{label:"确认密码",prop:"confirmPassword"},{default:l(()=>[e(m,{modelValue:d.value.confirmPassword,"onUpdate:modelValue":a[11]||(a[11]=u=>d.value.confirmPassword=u),type:"password","show-password":""},null,8,["modelValue"])]),_:1})]),_:1}),e(t),e(t,null,{default:l(()=>[e(z,{"fill-ratio":50,style:{width:"100%","justify-content":"center"}},{default:l(()=>[e(_,{onClick:E},{default:l(()=>[...a[14]||(a[14]=[i("重置",-1)])]),_:1}),e(_,{type:"primary",onClick:F},{default:l(()=>[...a[15]||(a[15]=[i("保存",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})),[[T,p.value]])}}};export{le as default};
