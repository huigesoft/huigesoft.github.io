const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ThresholdAlarm-B3-Gmq5h.js","assets/index-CLxOXX9K.js","assets/index-Bj5WFYBL.css","assets/DeviationAlarm-B0v6ECHV.js","assets/RateAlarm-BjhJ2-h0.js","assets/MatchingAlarm-t2gSbWUW.js"])))=>i.map(i=>d[i]);
import{i as F,e as $,f as le,_ as te,I as u,O as m,q as i,N as z,J as B,D as se,r as v,n as ne,c as N,o as p,x as n,p as oe,w as r,F as P,G as ie,g as U,z as c,U as re,S as _,E as M,d as h,K as d}from"./index-CLxOXX9K.js";import{l as ue}from"./alarm-level-SqVy_6NR.js";import{l as ce}from"./tpl-tag-D_2g8AFQ.js";const j=le.service.hdb,de=f=>F({method:"post",url:j+"/hdb/tpl-alarm/saveOrUpdateBatch",data:f}).catch($),fe=f=>F({method:"post",url:j+"/hdb/tpl-alarm/list",data:f}).catch($),me={__name:"TplAlarm",setup(f,{expose:G}){const H=_(()=>h(()=>import("./ThresholdAlarm-B3-Gmq5h.js"),__vite__mapDeps([0,1,2]))),J=_(()=>h(()=>import("./DeviationAlarm-B0v6ECHV.js"),__vite__mapDeps([3,1,2]))),K=_(()=>h(()=>import("./RateAlarm-BjhJ2-h0.js"),__vite__mapDeps([4,1,2]))),S=_(()=>h(()=>import("./MatchingAlarm-t2gSbWUW.js"),__vite__mapDeps([5,1,2]))),x=u("tpl",null);u("tplId",null);const g=u("tag",{}),b=u("tagId",null),Q=u("alarmVisible",!1),E=m("thresholdRef"),D=m("deviationRef"),k=m("rateRef"),q=m("matchingRef"),y=i(!1),w=i("threshold"),O=z([]);d("levels",O);const R=z([]),C=i(null);d("threshold",C);const A=i({});d("deviation",A);const T=i({});d("rate",T);const V=i({});d("matching",V);const W=e=>{const a=R.value.find(s=>s.tagId===e);a&&(g.value=a)},X=()=>{C.value=null,A.value=null,T.value=null,V.value=null},Y=()=>{ue({}).then(e=>{e.success&&(O.value=e.value)})},Z=()=>{const e={expressions:[{field:"tplCode",query:"eq",value:x.value?.tplCode}]};ce(e).then(a=>{a.success&&(R.value=a.value)})},L=()=>{y.value=!0,fe({expressions:[{field:"tplCode",value:x.value?.tplCode,query:"eq"},{field:"tagName",value:g.value?.tagName,query:"eq"}]}).then(e=>{if(y.value=!1,e.success){X();const a=e.value;for(let s=0;s<a.length;s++){const l=a[s];l.alarmType===1?C.value=l:l.alarmType===2?A.value=l:l.alarmType===3?T.value=l:l.alarmType===4&&(V.value=l)}}})},ee=()=>{const e=E.value?.getAlarmConfig(),a=D.value?.getAlarmConfig(),s=k.value?.getAlarmConfig(),l=q.value?.getAlarmConfig(),t=[];e&&t.push(e),a&&t.push(a),s&&t.push(s),l&&t.push(l),t.length>0?de(t).then(I=>{I.success&&(M({message:"保存成功！",type:"success"}),L())}):M({message:"未做修改！",type:"warning"})};return B(Q,e=>{e&&Z()},{immediate:!0}),B(g,e=>{e!==null&&L()},{immediate:!0}),se(()=>{Y()}),G({save:ee}),(e,a)=>{const s=v("el-option"),l=v("el-select"),t=v("el-tab-pane"),I=v("el-tabs"),ae=ne("loading");return p(),N(P,null,[n(l,{modelValue:c(b),"onUpdate:modelValue":a[0]||(a[0]=o=>re(b)?b.value=o:null),style:{width:"250px"},onChange:W,filterable:""},{default:r(()=>[(p(!0),N(P,null,ie(R.value,o=>(p(),U(s,{value:o.tagId,label:o.tagName+"-"+o.tagTitle},null,8,["value","label"]))),256))]),_:1},8,["modelValue"]),oe((p(),U(I,{style:{height:"calc(100% - 45px)"},modelValue:w.value,"onUpdate:modelValue":a[1]||(a[1]=o=>w.value=o)},{default:r(()=>[n(t,{label:"阈值报警",name:"threshold",lazy:""},{default:r(()=>[n(c(H),{ref_key:"thresholdRef",ref:E},null,512)]),_:1}),n(t,{label:"偏差报警",name:"deviation",lazy:""},{default:r(()=>[n(c(J),{ref_key:"deviationRef",ref:D},null,512)]),_:1}),n(t,{label:"变化率报警",name:"rate",lazy:""},{default:r(()=>[n(c(K),{ref_key:"rateRef",ref:k},null,512)]),_:1}),n(t,{label:"匹配报警",name:"matching",lazy:""},{default:r(()=>[n(c(S),{ref_key:"matchingRef",ref:q},null,512)]),_:1})]),_:1},8,["modelValue"])),[[ae,y.value]])],64)}}},he=te(me,[["__scopeId","data-v-3bd9b28d"]]);export{he as default};
