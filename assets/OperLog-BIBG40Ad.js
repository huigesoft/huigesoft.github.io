import{i as I,e as U,f as v,q as _,s as $,D as j,r as n,n as H,c as m,o as i,x as e,w as t,z as D,p as L,g as O,b as p,t as z,F as f,E as A}from"./index-CLxOXX9K.js";const q=v.service.system,G=c=>I({method:"post",url:q+"/sys/oper-log/pageBySql",data:c}).catch(U),J=c=>I({method:"get",url:q+"/sys/oper-log/getById",params:c}).catch(U),W={__name:"OperLog",setup(c){const C=_(null),M=_(null),b=_(!1),w=_([]),u=_({}),y=_(!1),o=$({loading:!1,open:!1,params:{total:0,page:1,size:v.pageInfo.pageSize,expressions:[{field:"operName",query:"like",value:""},{field:"loginIp",query:"like",value:""},{field:"module",query:"like",value:""}],sorts:[{field:"operTime",direction:"DESC"}]}}),x=()=>{b.value=!0,G(o.params).then(s=>{b.value=!1,s.success?(w.value=s.value.records,o.params.total=s.value.total,o.params.page=s.value.current):(w.value=[],A({message:s?.exception||s?.msg||"操作失败！",type:"error"}))})},S=s=>{u.value={},J({id:s.logId}).then(a=>{y.value=!0,u.value=a.value})};return j(()=>{x()}),(s,a)=>{const g=n("el-input"),d=n("el-form-item"),V=n("el-button"),k=n("el-form"),r=n("el-table-column"),B=n("el-tag"),T=n("el-table"),E=n("el-pagination"),F=n("h-list-layout"),h=n("el-col"),N=n("el-row"),R=n("h-modal"),P=H("loading");return i(),m(f,null,[e(F,null,{header:t(()=>[e(k,{inline:!0},{default:t(()=>[e(d,{label:"用户名"},{default:t(()=>[e(g,{modelValue:o.params.expressions[0].value,"onUpdate:modelValue":a[0]||(a[0]=l=>o.params.expressions[0].value=l),style:{width:"150px"},clearable:""},null,8,["modelValue"])]),_:1}),e(d,{label:"IP地址"},{default:t(()=>[e(g,{modelValue:o.params.expressions[1].value,"onUpdate:modelValue":a[1]||(a[1]=l=>o.params.expressions[1].value=l),style:{width:"150px"},clearable:""},null,8,["modelValue"])]),_:1}),e(d,{label:"模块"},{default:t(()=>[e(g,{modelValue:o.params.expressions[2].value,"onUpdate:modelValue":a[2]||(a[2]=l=>o.params.expressions[2].value=l),style:{width:"150px"},clearable:""},null,8,["modelValue"])]),_:1}),e(d,null,{default:t(()=>[e(V,{type:"primary",icon:"Search",round:"",onClick:x},{default:t(()=>[...a[10]||(a[10]=[p("查询",-1)])]),_:1})]),_:1})]),_:1})]),main:t(()=>[L((i(),O(T,{ref_key:"tableRef",ref:C,style:{width:"100%"},height:"100%",data:w.value,"highlight-current-row":"",stripe:"","show-overflow-tooltip":""},{default:t(()=>[e(r,{type:"selection",width:"55",fixed:"left"}),e(r,{prop:"status",label:"状态","min-width":"80"},{default:t(l=>[e(B,{type:l.row.status===0?"success":"danger"},{default:t(()=>[p(z(l.row.status===0?"成功":"失败"),1)]),_:2},1032,["type"])]),_:1}),e(r,{prop:"operName",label:"操作用户","min-width":"120"}),e(r,{prop:"module",label:"模块","min-width":"120"}),e(r,{prop:"description",label:"描述","min-width":"180"}),e(r,{prop:"type",label:"类型","min-width":"80"},{default:t(l=>[l.row.type===1?(i(),m(f,{key:0},[p("新增")],64)):l.row.type===2?(i(),m(f,{key:1},[p("修改")],64)):l.row.type===3?(i(),m(f,{key:2},[p("删除")],64)):l.row.type===4?(i(),m(f,{key:3},[p("查询")],64)):l.row.type===0?(i(),m(f,{key:4},[p("其它")],64)):(i(),m(f,{key:5},[p("未知")],64))]),_:1}),e(r,{prop:"method",label:"执行方法","min-width":"120"}),e(r,{prop:"httpMethod",label:"请求方式","min-width":"80"}),e(r,{prop:"operUrl",label:"请求地址","min-width":"180"}),e(r,{prop:"operTime",label:"请求时间","min-width":"180"},{default:t(l=>[p(z(s.$defaultDateTimeFormat(l.row.operTime)),1)]),_:1}),e(r,{prop:"execTimes",label:"消耗时间(ms)","min-width":"130"}),e(r,{prop:"operIp",label:"请求IP","min-width":"120"}),e(r,{prop:"action",label:"操作","min-width":80,fixed:"right",align:"center"},{default:t(l=>[e(V,{type:"primary",size:"small",title:"详情",icon:"MoreFilled",onClick:K=>S(l.row),circle:""},null,8,["onClick"])]),_:1})]),_:1},8,["data"])),[[P,b.value]])]),footer:t(()=>[e(E,{"current-page":o.params.page,"onUpdate:currentPage":a[3]||(a[3]=l=>o.params.page=l),"page-size":o.params.size,"onUpdate:pageSize":a[4]||(a[4]=l=>o.params.size=l),total:o.params.total,layout:D(v).pageInfo.layout,"page-sizes":D(v).pageInfo.pageSizes,"pager-count":5,onChange:x,background:"",size:"small"},null,8,["current-page","page-size","total","layout","page-sizes"])]),_:1}),e(R,{modelValue:y.value,"onUpdate:modelValue":a[9]||(a[9]=l=>y.value=l),title:"用户信息",width:"800"},{footer:t(()=>[e(V,{onClick:a[8]||(a[8]=()=>y.value=!1)},{default:t(()=>[...a[11]||(a[11]=[p("取消",-1)])]),_:1})]),default:t(()=>[e(k,{ref_key:"formRef",ref:M,model:u.value,"label-width":"120px","label-suffix":"："},{default:t(()=>[e(N,null,{default:t(()=>[e(h,{span:24},{default:t(()=>[e(d,{label:"请求参数",prop:"requestData"},{default:t(()=>[e(g,{modelValue:u.value.requestData,"onUpdate:modelValue":a[5]||(a[5]=l=>u.value.requestData=l),rows:4,type:"textarea",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(h,{span:24},{default:t(()=>[e(d,{label:"响应数据",prop:"responseData"},{default:t(()=>[e(g,{modelValue:u.value.responseData,"onUpdate:modelValue":a[6]||(a[6]=l=>u.value.responseData=l),rows:8,type:"textarea",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(h,{span:24},{default:t(()=>[e(d,{label:"错误信息",prop:"errorMsg"},{default:t(()=>[e(g,{modelValue:u.value.errorMsg,"onUpdate:modelValue":a[7]||(a[7]=l=>u.value.errorMsg=l),rows:3,type:"textarea",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}};export{W as default};
