import{i as C,e as w,f as B,I as P,N as M,q as y,J as A,r,n as Q,p as W,g as S,o as x,w as a,x as l,c as G,F as H,G as K,E as v,s as Y,D as Z,z as L,b as T,K as ee}from"./index-CLxOXX9K.js";import{u as le}from"./utils-B5efKl0g.js";import{l as te}from"./tpl-tag-D_2g8AFQ.js";import{l as ae}from"./industry-prop-ClrDOWDh.js";const I=B.service.hdb,oe=p=>C({method:"post",url:I+"/hdb/tpl-prop/saveOrUpdate",data:p}).catch(w),se=p=>C({method:"post",url:I+"/hdb/tpl-prop/page",data:p}).catch(w),ne=p=>C({method:"post",url:I+"/hdb/tpl-prop/checkExists",data:p}).catch(w),re=p=>C({method:"get",url:I+"/hdb/tpl-prop/getById",params:p}).catch(w),pe=p=>C({method:"post",url:I+"/hdb/tpl-prop/deleteById",params:p}).catch(w),ue=p=>C({method:"post",url:I+"/hdb/tpl-prop/deleteByIds",data:p}).catch(w),ie={__name:"TplPropForm",emits:["onSave"],setup(p,{expose:q,emit:E}){const k=E,{hasText:N}=le(),b=P("tpl",{}),i=P("propId",null),g=M([]),h=M([]),o=y({}),m=y(null),V=y(!1),$={propName:[{validator:async(s,u)=>{if(!N(u))return Promise.reject("请输入点名");const _={propName:u,tplCode:b.value?.tplCode,idValue:o.value.propId,id:"propId"};await ne(_).then(c=>c.value?Promise.reject("已存在！"):Promise.resolve())},trigger:"blur"}],propTitle:[{required:!0,message:"请输入标题",trigger:"blur"}]},D=s=>{const u=h.value.find(_=>_.propName);u!==void 0&&(o.value.propTitle=u.propTitle)},n=()=>{re({id:i.value}).then(s=>{s.success?o.value=s.value:(o.value={},v({message:s?.exception||s?.msg||"操作失败！",type:"error"}))})},e=()=>{m.value.validate().then(()=>{V.value=!0,oe(o.value).then(s=>{V.value=!1,s?.success?(o.value=s.value,v({message:"保存成功！",type:"success"}),k("onSave")):v({message:s?.exception||s?.msg||"操作失败！",type:"error"})})})},d=()=>{i.value=null,o.value={tplCode:b.value?.tplCode}},z=()=>{te({expressions:[{field:"tplCode",query:"eq",value:b.value?.tplCode}]}).then(s=>{s.success&&(g.value=s.value)})},f=()=>{ae({expressions:[{field:"indCode",query:"eq",value:b.value?.indCode}]}).then(s=>{s.success&&(h.value=s.value)})};return A(i,s=>{z(),f(),s!==null?n():d()},{immediate:!0}),q({save:e,reset:d}),(s,u)=>{const _=r("el-option"),c=r("el-select"),R=r("el-form-item"),U=r("h-col"),j=r("el-row"),F=r("el-form"),O=Q("loading");return W((x(),S(F,{ref_key:"formRef",ref:m,model:o.value,"label-width":"120px",rules:$,"label-suffix":"："},{default:a(()=>[l(j,{gutter:10},{default:a(()=>[l(U,{sm:24},{default:a(()=>[l(R,{label:"行业属性",prop:"propName"},{default:a(()=>[l(c,{modelValue:o.value.propName,"onUpdate:modelValue":u[0]||(u[0]=t=>o.value.propName=t),filterable:"",clearable:"",onChange:D},{default:a(()=>[(x(!0),G(H,null,K(h.value,t=>(x(),S(_,{key:t.propName,label:t.propTitle,value:t.propName},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(U,{sm:24},{default:a(()=>[l(R,{label:"监控点",prop:"propTitle"},{default:a(()=>[l(c,{modelValue:o.value.tagName,"onUpdate:modelValue":u[1]||(u[1]=t=>o.value.tagName=t),filterable:"",clearable:""},{default:a(()=>[(x(!0),G(H,null,K(g.value,t=>(x(),S(_,{key:t.tagName,label:t.tagTitle+"--"+t.tagName,value:t.tagName},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])),[[O,V.value]])}}},ve={__name:"TplProp",setup(p){const q=P("tpl",{}),E=P("tplId",null),k=y(null);ee("propId",k);const N=y(null),b=y(null),i=y(!1),g=y(!1),h=M([]),o=Y({loading:!1,open:!1,params:{total:0,page:1,size:B.pageInfo.pageSize,expressions:[{field:"propName",query:"like",value:""},{field:"propTitle",query:"like",value:""},{field:"tplCode",query:"eq",value:q?.value?.tplCode}],sorts:[]}}),m=()=>{i.value=!0,se(o.params).then(n=>{i.value=!1,n.success?(h.value=n.value.records,o.params.total=n.value.total,o.params.page=n.value.current):(h.value=[],v({message:n?.exception||n?.msg||"操作失败！",type:"error"}))})},V=()=>{k.value=null,g.value=!0},J=n=>{k.value=n.propId,g.value=!0},$=n=>{i.value=!0,pe({id:n.propId}).then(e=>{i.value=!1,e.success?(v({message:"删除成功",type:"success"}),m()):v({message:e?.exception||e?.msg||"操作失败！",type:"error"})})},D=()=>{const n=b.value.getSelectionRows();if(n.length===0)v({type:"error",message:"请选择要删除的内容？"});else{const e=n.map(d=>d.propId);i.value=!0,ue(e).then(d=>{i.value=!1,d.success?(v({message:"删除成功",type:"success"}),m()):v({message:d?.exception||d?.msg||"操作失败！",type:"error"})})}};return A(E,n=>{o.params.expressions[2].value=q?.value?.tplCode,m()},{immediate:!0}),Z(()=>{m()}),(n,e)=>{const d=r("el-input"),z=r("el-form-item"),f=r("el-button"),s=r("el-popconfirm"),u=r("el-space"),_=r("el-form"),c=r("el-table-column"),R=r("el-table"),U=r("el-pagination"),j=r("h-list-layout"),F=r("h-modal"),O=Q("loading");return x(),G(H,null,[l(j,null,{header:a(()=>[l(_,{inline:!0},{default:a(()=>[l(z,{label:"点名"},{default:a(()=>[l(d,{modelValue:o.params.expressions[0].value,"onUpdate:modelValue":e[0]||(e[0]=t=>o.params.expressions[0].value=t),style:{width:"150px"},clearable:""},null,8,["modelValue"])]),_:1}),l(z,{label:"点标题"},{default:a(()=>[l(d,{modelValue:o.params.expressions[1].value,"onUpdate:modelValue":e[1]||(e[1]=t=>o.params.expressions[1].value=t),style:{width:"150px"},clearable:""},null,8,["modelValue"])]),_:1}),l(z,null,{default:a(()=>[l(f,{type:"primary",icon:"Search",round:"",onClick:m},{default:a(()=>[...e[9]||(e[9]=[T("查询",-1)])]),_:1})]),_:1}),l(u,null,{default:a(()=>[l(f,{type:"success",icon:"CirclePlus",onClick:V},{default:a(()=>[...e[10]||(e[10]=[T("新增",-1)])]),_:1}),l(s,{title:"确定要删除吗？",onConfirm:e[2]||(e[2]=t=>D())},{reference:a(()=>[l(f,{type:"danger",icon:"Remove"},{default:a(()=>[...e[11]||(e[11]=[T("删除",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),main:a(()=>[W((x(),S(R,{ref_key:"tableRef",ref:b,style:{width:"100%"},height:"100%",data:h.value,"highlight-current-row":"",stripe:"","show-overflow-tooltip":""},{default:a(()=>[l(c,{fixed:"left",type:"selection",width:"40"}),l(c,{prop:"propName",label:"行业属性名","min-width":"120"}),l(c,{prop:"propTitle",label:"行业属性标题","min-width":"120"}),l(c,{prop:"tagName",label:"监控点","min-width":"120"}),l(c,{prop:"action",label:"操作","min-width":120,fixed:"right",align:"center"},{default:a(t=>[l(f,{type:"primary",size:"small",title:"编辑",icon:"Edit",onClick:X=>J(t.row),circle:""},null,8,["onClick"]),l(s,{title:"确定要删除吗？",onConfirm:X=>$(t.row)},{reference:a(()=>[l(f,{type:"danger",size:"small",title:"删除",icon:"Remove",circle:""})]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[O,i.value]])]),footer:a(()=>[l(U,{"current-page":o.params.page,"onUpdate:currentPage":e[3]||(e[3]=t=>o.params.page=t),"page-size":o.params.size,"onUpdate:pageSize":e[4]||(e[4]=t=>o.params.size=t),total:o.params.total,layout:L(B).pageInfo.layout,"page-sizes":L(B).pageInfo.pageSizes,"pager-count":5,onChange:m,background:"",size:"small"},null,8,["current-page","page-size","total","layout","page-sizes"])]),_:1}),l(F,{modelValue:g.value,"onUpdate:modelValue":e[7]||(e[7]=t=>g.value=t),title:"行业属性绑定",width:"500px",onClose:e[8]||(e[8]=t=>N.value?.reset())},{footer:a(()=>[l(f,{onClick:e[5]||(e[5]=()=>g.value=!1)},{default:a(()=>[...e[12]||(e[12]=[T("关闭",-1)])]),_:1}),l(f,{type:"primary",onClick:e[6]||(e[6]=()=>N.value.save())},{default:a(()=>[...e[13]||(e[13]=[T("保存",-1)])]),_:1})]),default:a(()=>[l(ie,{ref_key:"formRef",ref:N,onOnSave:m},null,512)]),_:1},8,["modelValue"])],64)}}};export{ve as default};
