import{I as $,q as g,J as L,r as u,n as H,p as Q,g as B,o as z,w as l,x as e,a as te,z as G,c as W,b as w,F as X,G as ae,E as b,N as oe,s as ne,f as A,D as ue,t as se,K}from"./index-CLxOXX9K.js";import{s as re,g as ie,c as pe,p as me,d as de,a as fe}from"./tpl-attr-CqzkjWlj.js";import{u as ce}from"./utils-B5efKl0g.js";const ve={__name:"TplAttrForm",emits:["onSave"],setup(Y,{expose:R,emit:q}){const{hasText:y}=ce(),I=q,h=$("tpl",null),k=$("attrId",null),t=g({}),f=g([]),x=g(null),m=g(!1),D={attrName:[{validator:async(n,o)=>{if(!y(o))return Promise.reject("请输入点名");const c={attrName:o,tplCode:h.value?.tplCode,idValue:t.value.attrId,id:"attrId"};await pe(c).then(s=>s.value?Promise.reject("已存在！"):Promise.resolve())},trigger:"blur"}],attrTitle:[{required:!0,message:"请输入标题",trigger:"blur"}]},P=()=>{ie({id:k.value}).then(n=>{n.success?(t.value=n.value,y(t.value.attrConfig)&&(f.value=JSON.parse(t.value.attrConfig))):(t.value={},b({message:n?.exception||n?.msg||"操作失败！",type:"error"}))})},j=()=>{x.value.validate().then(()=>{m.value=!0,y(f.value)&&(t.value.attrConfig=JSON.stringify(f.value)),re(t.value).then(n=>{m.value=!1,n?.success?(t.value=n.value,b({message:"保存成功！",type:"success"}),I("onSave")):b({message:n?.exception||n?.msg||"操作失败！",type:"error"})})})},O=()=>{k.value=null,t.value={tplCode:h.value?.tplCode,attrType:1,attrEnable:1}},i=()=>{f.value.push({label:"",value:""})},a=n=>{f.value.splice(n,1)},v=n=>{let o=f.value,c=n,s=n;n===0?s=o.length-1:s=n-1;let p=o[s];o[s]=o[c],o[c]=p},N=n=>{let o=f.value,c=n,s=n;n===o.length-1?s=0:s=n+1;let p=o[s];o[s]=o[c],o[c]=p};return L(k,n=>{n!==null?P():O()},{immediate:!0}),R({save:j,reset:O}),(n,o)=>{const c=u("el-input"),s=u("el-form-item"),p=u("h-col"),_=u("el-option"),F=u("el-select"),C=u("el-col"),T=u("el-button"),E=u("el-row"),J=u("el-button-group"),r=u("h-dy-compo"),S=u("el-input-number"),Z=u("el-switch"),ee=u("el-form"),le=H("loading");return Q((z(),B(ee,{ref_key:"formRef",ref:x,model:t.value,"label-width":"120px",rules:D,"label-suffix":"："},{default:l(()=>[e(E,{gutter:10},{default:l(()=>[e(p,{sm:24},{default:l(()=>[e(s,{label:"属性名",prop:"attrName"},{default:l(()=>[e(c,{modelValue:t.value.attrName,"onUpdate:modelValue":o[0]||(o[0]=d=>t.value.attrName=d),disabled:G(y)(t.value?.attrId),clearable:""},null,8,["modelValue","disabled"])]),_:1})]),_:1}),e(p,{sm:24},{default:l(()=>[e(s,{label:"属性标题",prop:"attrTitle"},{default:l(()=>[e(c,{modelValue:t.value.attrTitle,"onUpdate:modelValue":o[1]||(o[1]=d=>t.value.attrTitle=d),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{sm:24},{default:l(()=>[e(s,{label:"类型",prop:"attrType"},{default:l(()=>[e(F,{modelValue:t.value.attrType,"onUpdate:modelValue":o[2]||(o[2]=d=>t.value.attrType=d)},{default:l(()=>[e(_,{label:"文本框",value:1}),e(_,{label:"数字框",value:2}),e(_,{label:"下拉框",value:3}),e(_,{label:"单选框",value:4}),e(_,{label:"复选框",value:5}),e(_,{label:"开关",value:6}),e(_,{label:"日期框",value:7}),e(_,{label:"日期时间框",value:8})]),_:1},8,["modelValue"])]),_:1})]),_:1}),t.value.attrType===3||t.value.attrType===4?(z(),B(p,{key:0,sm:24},{default:l(()=>[e(s,{label:"配置项",prop:"attrRule"},{default:l(()=>[e(E,{gutter:5,style:{width:"100%"}},{default:l(()=>[e(C,{span:8},{default:l(()=>[...o[6]||(o[6]=[w("显示名",-1)])]),_:1}),e(C,{span:8},{default:l(()=>[...o[7]||(o[7]=[w("存储值",-1)])]),_:1}),e(C,{span:8},{default:l(()=>[e(T,{type:"primary",size:"small",icon:"Plus",onClick:i})]),_:1})]),_:1}),(z(!0),W(X,null,ae(f.value,(d,M)=>(z(),B(E,{gutter:5,style:{width:"100%"}},{default:l(()=>[e(C,{span:8},{default:l(()=>[e(c,{modelValue:d.label,"onUpdate:modelValue":U=>d.label=U},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(C,{span:8},{default:l(()=>[e(c,{modelValue:d.value,"onUpdate:modelValue":U=>d.value=U},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(C,{span:8},{default:l(()=>[e(J,null,{default:l(()=>[e(T,{size:"small",icon:"Top",onClick:U=>v(M)},null,8,["onClick"]),e(T,{size:"small",icon:"Bottom",onClick:U=>N(M)},null,8,["onClick"]),e(T,{size:"small",icon:"Minus",onClick:U=>a(M)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),256))]),_:1})]),_:1})):te("",!0),e(p,{sm:24},{default:l(()=>[e(s,{label:"默认值",prop:"attrValue"},{default:l(()=>[e(r,{type:t.value.attrType,config:JSON.stringify(f.value),modelValue:t.value.attrValue,"onUpdate:modelValue":o[3]||(o[3]=d=>t.value.attrValue=d)},null,8,["type","config","modelValue"])]),_:1})]),_:1}),e(p,{sm:24},{default:l(()=>[e(s,{label:"排序号",prop:"attrOrder"},{default:l(()=>[e(S,{modelValue:t.value.attrOrder,"onUpdate:modelValue":o[4]||(o[4]=d=>t.value.attrOrder=d)},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{sm:24},{default:l(()=>[e(s,{label:"启用",prop:"attrEnable"},{default:l(()=>[e(Z,{modelValue:t.value.attrEnable,"onUpdate:modelValue":o[5]||(o[5]=d=>t.value.attrEnable=d),"inline-prompt":"","active-value":1,"inactive-value":0,"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])),[[le,m.value]])}}},ye={__name:"TplAttr",setup(Y){const R=$("tpl",null),q=$("tplId",null),y=g(null);K("attrId",y);const I=g(null);K("attr",I);const h=g(null),k=g(null),t=g(!1),f=g(!1),x=oe([]),m=ne({loading:!1,open:!1,params:{total:0,page:1,size:A.pageInfo.pageSize,expressions:[{field:"attrName",query:"like",value:""},{field:"attrTitle",query:"like",value:""},{field:"tplCode",query:"eq",value:R.value?.tplCode}],sorts:[{field:"attrOrder"}]}}),V=()=>{t.value=!0,me(m.params).then(i=>{t.value=!1,i.success?(x.value=i.value.records,m.params.total=i.value.total,m.params.page=i.value.current):(x.value=[],b({message:i?.exception||i?.msg||"操作失败！",type:"error"}))})},D=()=>{y.value=null,I.value={},f.value=!0},P=i=>{y.value=i.attrId,I.value=i,f.value=!0},j=i=>{t.value=!0,de({id:i.attrId}).then(a=>{t.value=!1,a.success?(b({message:"删除成功",type:"success"}),V()):b({message:a?.exception||a?.msg||"操作失败！",type:"error"})})},O=()=>{const i=k.value.getSelectionRows();if(i.length===0)b({type:"error",message:"请选择要删除的内容？"});else{const a=i.map(v=>v.attrId);t.value=!0,fe(a).then(v=>{t.value=!1,v.success?(b({message:"删除成功",type:"success"}),V()):b({message:v?.exception||v?.msg||"操作失败！",type:"error"})})}};return L(q,i=>{m.params.expressions[2].value=R.value?.tplCode,V()},{immediate:!0}),ue(()=>{V()}),(i,a)=>{const v=u("el-input"),N=u("el-form-item"),n=u("el-button"),o=u("el-popconfirm"),c=u("el-space"),s=u("el-form"),p=u("el-table-column"),_=u("el-switch"),F=u("el-table"),C=u("el-pagination"),T=u("h-list-layout"),E=u("h-modal"),J=H("loading");return z(),W(X,null,[e(T,null,{header:l(()=>[e(s,{inline:!0},{default:l(()=>[e(N,{label:"属性名称"},{default:l(()=>[e(v,{modelValue:m.params.expressions[0].value,"onUpdate:modelValue":a[0]||(a[0]=r=>m.params.expressions[0].value=r),style:{width:"150px"},clearable:""},null,8,["modelValue"])]),_:1}),e(N,{label:"属性标题"},{default:l(()=>[e(v,{modelValue:m.params.expressions[1].value,"onUpdate:modelValue":a[1]||(a[1]=r=>m.params.expressions[1].value=r),style:{width:"150px"},clearable:""},null,8,["modelValue"])]),_:1}),e(N,null,{default:l(()=>[e(n,{type:"primary",icon:"Search",round:"",onClick:V},{default:l(()=>[...a[8]||(a[8]=[w("查询",-1)])]),_:1})]),_:1}),e(c,null,{default:l(()=>[e(n,{type:"success",icon:"CirclePlus",onClick:D},{default:l(()=>[...a[9]||(a[9]=[w("新增",-1)])]),_:1}),e(o,{title:"确定要删除吗？",onConfirm:a[2]||(a[2]=r=>O())},{reference:l(()=>[e(n,{type:"danger",icon:"Remove"},{default:l(()=>[...a[10]||(a[10]=[w("删除",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),main:l(()=>[Q((z(),B(F,{ref_key:"tableRef",ref:k,style:{width:"100%"},height:"100%",data:x.value,"highlight-current-row":"",stripe:"","show-overflow-tooltip":""},{default:l(()=>[e(p,{fixed:"left",type:"selection",width:"40"}),e(p,{prop:"attrName",label:"属性名称","min-width":"120"}),e(p,{prop:"attrTitle",label:"属性标题","min-width":"120"}),e(p,{prop:"attrType",label:"类型","min-width":"120"},{default:l(r=>[w(se(i.$componentFormat(r.row.attrType)),1)]),_:1}),e(p,{prop:"attrOrder",label:"排序号","min-width":"120"}),e(p,{prop:"attrEnable",label:"状态","min-width":"80"},{default:l(r=>[e(_,{modelValue:r.row.attrEnable,"onUpdate:modelValue":S=>r.row.attrEnable=S,"inline-prompt":"","active-value":1,"inactive-value":0,"active-text":"启用","inactive-text":"禁用","before-change":()=>!1,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(p,{prop:"action",label:"操作","min-width":120,fixed:"right",align:"center"},{default:l(r=>[e(n,{type:"primary",size:"small",title:"编辑",icon:"Edit",onClick:S=>P(r.row),circle:""},null,8,["onClick"]),e(o,{title:"确定要删除吗？",onConfirm:S=>j(r.row)},{reference:l(()=>[e(n,{type:"danger",size:"small",title:"删除",icon:"Remove",circle:""})]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[J,t.value]])]),footer:l(()=>[e(C,{"current-page":m.params.page,"onUpdate:currentPage":a[3]||(a[3]=r=>m.params.page=r),"page-size":m.params.size,"onUpdate:pageSize":a[4]||(a[4]=r=>m.params.size=r),total:m.params.total,layout:G(A).pageInfo.layout,"page-sizes":G(A).pageInfo.pageSizes,"pager-count":5,onChange:V,background:"",size:"small"},null,8,["current-page","page-size","total","layout","page-sizes"])]),_:1}),e(E,{modelValue:f.value,"onUpdate:modelValue":a[7]||(a[7]=r=>f.value=r),title:"扩展属性",width:"500px"},{footer:l(()=>[e(n,{onClick:a[5]||(a[5]=()=>f.value=!1)},{default:l(()=>[...a[11]||(a[11]=[w("关闭",-1)])]),_:1}),e(n,{type:"primary",onClick:a[6]||(a[6]=()=>h.value.save())},{default:l(()=>[...a[12]||(a[12]=[w("保存",-1)])]),_:1})]),default:l(()=>[e(ve,{ref_key:"formRef",ref:h,onOnSave:V},null,512)]),_:1},8,["modelValue"])],64)}}};export{ye as default};
